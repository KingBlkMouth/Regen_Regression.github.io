<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regen 2 - 1 Import Clean</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Regen 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./1.0_Import_Clean.html" aria-current="page"> 
<span class="menu-text">1 Import Clean</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./1.5_DB_Create.html"> 
<span class="menu-text">1.5 DB Create</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./2_FVS_Variables.html"> 
<span class="menu-text">2 FVS Vars</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./3_RandomForests_Prep.html"> 
<span class="menu-text">3 RF Prep</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./4_RF_by_Eco.html"> 
<span class="menu-text">4 RF Ecos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./5_TD_Imp.html"> 
<span class="menu-text">5 TD Imp</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./6_distributions.html"> 
<span class="menu-text">6 Histos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./7_RF_GroupSpp_and_Counts.html"> 
<span class="menu-text">7 RF Groups &amp; Counts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./8_RF_Spp_Groups.html"> 
<span class="menu-text">8 RF Spp Groups</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./9_RF_Regression.html"> 
<span class="menu-text">9 RF Reg</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./10_Hyperparameters.html"> 
<span class="menu-text">10 Hyper Params</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./11_Heatmap.html"> 
<span class="menu-text">11- 1st Map</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./12_Error_Map.html"> 
<span class="menu-text">12 Error Map</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#pseudo-code" id="toc-pseudo-code" class="nav-link" data-scroll-target="#pseudo-code">Pseudo Code</a></li>
  <li><a href="#subset-fia-plots." id="toc-subset-fia-plots." class="nav-link" data-scroll-target="#subset-fia-plots.">1 Subset fia Plots.</a></li>
  <li><a href="#ecoregions" id="toc-ecoregions" class="nav-link" data-scroll-target="#ecoregions">2 EcoRegions</a></li>
  <li><a href="#subplot-table." id="toc-subplot-table." class="nav-link" data-scroll-target="#subplot-table.">3. SubPlot Table.</a></li>
  <li><a href="#habitat-type-exploration" id="toc-habitat-type-exploration" class="nav-link" data-scroll-target="#habitat-type-exploration">Habitat Type exploration</a>
  <ul class="collapse">
  <li><a href="#fpas" id="toc-fpas" class="nav-link" data-scroll-target="#fpas">FPAs</a>
  <ul class="collapse">
  <li><a href="#descriptions" id="toc-descriptions" class="nav-link" data-scroll-target="#descriptions">descriptions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#trying-sci-names" id="toc-trying-sci-names" class="nav-link" data-scroll-target="#trying-sci-names">Trying sci names</a></li>
  <li><a href="#save" id="toc-save" class="nav-link" data-scroll-target="#save">Save</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">1 Import Clean</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Libraries</em></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger (Mb) max used (Mb)
Ncells  597000 31.9    1362492 72.8   686442 36.7
Vcells 1099134  8.4    8388608 64.0  1875860 14.4</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>clean_mem <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">ls</span>(<span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ls()[!(ls() %in% keep)]</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> x[<span class="sc">!</span>(x <span class="sc">%in%</span> keep)], <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"keep"</span>, <span class="st">"clean_mem"</span>, <span class="st">"clean_na_cols"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>clean_na_cols <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(df)) <span class="sc">&lt;</span> <span class="fu">nrow</span>(df)]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="intro" class="level1">
<h1>Intro</h1>
<p><strong>This is the first document in a data pipeline from raw input data to Random Forests imputation. This page will deal with filtering raw data from FIA up until the point I can run it in FVS.</strong></p>
</section>
<section id="pseudo-code" class="level1">
<h1>Pseudo Code</h1>
<ol type="1">
<li>Subset fia plots by FOA buffer</li>
</ol>
<ul>
<li>Extract the CN, latitude, and longitude of all FIA plots from the WA FIA.db.</li>
<li><del>save the CN list to a csv</del></li>
<li><del>Import the list to ArcGIS Pro (AGP)</del></li>
<li>Create an sf object from the lat/long</li>
<li>Set the Geodetic Coordinate system to match the FIA data (NAD83)</li>
<li>set the projected Coordinates system to match the 60k buffer. (Albers_Conic_Equal_Area)</li>
<li>Filter the FIA plots by the OkWen 60km buffer. <strong>Not the FOA_60km_Buffer</strong></li>
<li><del>save the subset to “C:/RxFire/Regen/Regen2_08Aug24/60k_buffer_fiaplots.csv”</del></li>
</ul>
<ol start="2" type="1">
<li>Get all plots from these EcoRegions in WA.</li>
</ol>
<ul>
<li>Pull all CNs from the 60km buffer and their ECORegion codes from the FIA PLOT table.</li>
<li>Create a list of all unique EcoRegions inside the Buffer</li>
<li>Pull every plot in WA that is coded with an Ecoregion in that list.</li>
<li>Pull the conditions for plots with the correct EcoRegion from the COND table.</li>
<li>Subset the list to ensure that we have single condition plots.</li>
<li>Filter out plots that are on Non-Forest land.</li>
<li>Filter out plots that have artificial regeneration.</li>
<li>Filter out plots that are coded as non-forest. i.e.&nbsp;Ag, Range, Beach, windbreak</li>
<li>Filter out plots with fire damage.</li>
<li>Check out the trees per plot.</li>
</ul>
<ol start="3" type="1">
<li>Filter from the SubPlot table.</li>
</ol>
<ul>
<li>Copy Kralicek and ensure that microplot conditions match subplot conditions.
<ul>
<li>Filtering twice is probably redundant, if they are single cond, they should be the same condition.</li>
</ul></li>
<li>control for microcond == subpcond.</li>
<li>control for near(SUBPCOND_PROP, 1, tol = .025) &amp; near(MICRCOND_PROP, 1, tol = .025)</li>
<li>Filter for FPAGs that start with A, N, or W. These are Artificial, Non-Veg, and Water</li>
<li>fix ecoregion codes that were errors.</li>
</ul>
<p>There are 104 CNs that do not have a habitat type code. Last time, I dropped them because we had more data.<br>
I could go into the veg tables and determine the proper code, but that might be laborious.</p>
</section>
<section id="subset-fia-plots." class="level1">
<h1>1 Subset fia Plots.</h1>
<p>There were some Latitude and Longitudes that were entered as NA. They were dropped.</p>
<ul>
<li>Import the latitude and longitude of all FIA plots from the WA FIA.db.</li>
<li>save the CN list to a csv.</li>
<li>Import the list to ArcGIS Pro (AGP)</li>
<li>Clip the FIA plots by the 60km buffer</li>
<li>save the subset to “C:/RxFire/Regen/Regen2_08Aug24/60k_buffer_fiaplots.csv”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pulling in all Plots in WA. </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>() , <span class="st">"C:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>CNs <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select CN, lat, lon from PLOT"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># str(CNs)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping NAs and writing the Lat long to csv so that I can extract the plots inside of the 60km buffer in AGP. </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>CNs <span class="ot">&lt;-</span> CNs <span class="sc">|&gt;</span> <span class="fu">drop_na</span>()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># write_csv(CNs, "C:/RxFire/Regen/Regen2_08Aug24/WA_fiaplots.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In AGP, I clipped the Lat/Lon CN list by the 60km Buffer, then saved the new list as <em>./60k_buffer_fiaplots.csv</em>.</p>
<p>I later decided to subset the data in R. That way all of the metadata is right here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For reference, here is the set from AGP</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Buffer_plots <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/RxFire/Regen/Regeneration_2_16Sept24/data/60k_buffer_fiaplots.csv"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_types =</span> <span class="st">"cnnn"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>Buffer_plots<span class="sc">$</span>CN <span class="ot">&lt;-</span> <span class="fu">as.character</span>(Buffer_plots<span class="sc">$</span>CN)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Buffer_plots |&gt; head()</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the full set of FIA plots from the FIA db</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># WA_fiaplots &lt;- read_csv("C:/RxFire/Regen/Regen2_08Aug24/WA_fiaplots.csv",</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                         col_types = "cnn")</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>wa_plots_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(CNs, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LON"</span>, <span class="st">"LAT"</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># NAD83 (EPSG:4269) EPSG that matches the FIA data</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(wa_plots_sf) <span class="ot">&lt;-</span> <span class="dv">4269</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># st_geometry(wa_plots_sf)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the shape file</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="do">## OkWen 60k buffer</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># "C:/RxFire/GIS/gisData/OkWen_60k_buffer_shp/OkWen_60k_Buffer_shp.shp"</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">## FOA 60k buffer</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># "C:/Users/cmeck/Desktop/D_Anal/Spatial_Stats_wR/All_FOAs_shp/OkWen_cFOAs_Albers_60km_Buffer.shp"</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>pathshp <span class="ot">&lt;-</span> <span class="st">"C:/RxFire/GIS/gisData/OkWen_60k_buffer_shp/OkWen_60k_Buffer_shp.shp"</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>buffer60 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(pathshp, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># st_geometry(buffer60)</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting the FIA locations to project to the shape file</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>wa_plots_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(wa_plots_sf, <span class="fu">st_crs</span>(buffer60))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the map</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() + geom_sf(data = buffer60) + geom_sf(data = WA_fiaplots[1:1000,])</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding CNs in the buffer</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">st_filter</span>(wa_plots_sf, buffer60)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the output map</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() + geom_sf(data = buffer60) + geom_sf(data = y[1:1000,]) + </span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Y")</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Checking that the R method matches the AGP method</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>rcns <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>rcns <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">CN =</span> y<span class="sc">$</span>CN)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>agpcns <span class="ot">&lt;-</span> Buffer_plots <span class="sc">|&gt;</span> <span class="fu">select</span>(CN)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co"># rcns |&gt; nrow() == agpcns |&gt; nrow()</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(rcns, agpcns, <span class="at">by =</span> <span class="st">"CN"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7168</code></pre>
</div>
</div>
<p>The CNs from R are the same as the CNs from AGP.</p>
</section>
<section id="ecoregions" class="level1">
<h1>2 EcoRegions</h1>
<ul>
<li>Pull all CNs from the 60km buffer and their ECORegion codes from the FIA PLOT table.
<ul>
<li>Removing the short CNs that code for older plots not of the current design.</li>
</ul></li>
</ul>
<p>Ecoregions in the FVS Ready come from PLOT.ECOSUBCD in FIA.</p>
<p>In the full FIA db, there are plots that predate the current plot design. We cannot use those plots as they do not have a uniform design. Those plots are coded with CNs that have fewer characters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots inside the 60km buffer from WA FIA</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Buffer_plots <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/RxFire/Regen/Regeneration_2_16Sept24/data/60k_buffer_fiaplots.csv"</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>)) <span class="sc">|&gt;</span> <span class="fu">select</span>(CN)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Buffer_plots<span class="sc">$</span>CN <span class="ot">&lt;-</span> <span class="fu">as.character</span>(Buffer_plots<span class="sc">$</span>CN)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># str(Buffer_plots)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing those plots with shorter CNs.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>Buffer_plots <span class="ot">&lt;-</span> Buffer_plots <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">nchar</span>(CN) <span class="sc">&gt;</span> <span class="dv">9</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracking the number of plots</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>n_plots_in_60k <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(Buffer_plots<span class="sc">$</span>CN)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>n_plots_in_60k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6800</code></pre>
</div>
</div>
<p>There are 6,800 CNs that are within the 60km buffer and of the current design. The design codes that indicate a plot with the current design in WA are 501 or 502.</p>
<p>See Appendix G for design codes.</p>
<hr>
<ul>
<li>Create a list of all unique EcoRegions inside the Buffer</li>
<li>Pull every plot in WA that is coded with an Ecoregion in that list.
<ul>
<li>I had to include conditions for design code to keep the older plots out again.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">append</span>(keep, <span class="fu">c</span>(<span class="st">"Buffer_plots"</span>, <span class="st">"n_plots_in_60k"</span>)) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_mem</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells 2432250 129.9    4075827 217.7  4075827 217.7
Vcells 4217201  32.2   10146329  77.5  6997585  53.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecoregions matching those from plots inside the 60km buffer</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>() , <span class="st">"C:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>WA_ecos <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"SELECT CN, ECOSUBCD FROM PLOT"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>buffer_ecos <span class="ot">&lt;-</span> <span class="fu">left_join</span>(Buffer_plots, WA_ecos, <span class="fu">join_by</span>(CN <span class="sc">==</span> CN))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Unique EcoRegions inside 60 km buffer</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>buffer_ecos <span class="ot">&lt;-</span> <span class="fu">unique</span>(buffer_ecos<span class="sc">$</span>ECOSUBCD)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>buffer_ecos <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, buffer_ecos, <span class="st">"'"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>buffer_ecos <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(buffer_ecos)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># All plots with those same EcoRegion Codes</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>eco_cns <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">"select CN from PLOT where ECOSUBCD in ("</span>, buffer_ecos, <span class="st">") and DESIGNCD != 559 and DESIGNCD != 558"</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>n_plots_in_buffer_ecos <span class="ot">&lt;-</span> eco_cns <span class="sc">%&gt;%</span> <span class="fu">n_distinct</span>()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>n_plots_in_buffer_ecos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13380</code></pre>
</div>
</div>
<p>13,380 plots of the current design that are in Ecoregions that are also within the 60km buffer.</p>
<hr>
<ul>
<li>Pull the conditions for plots with the correct EcoRegion from the COND table.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the conditions of those plots with matching Ecos. </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>() , <span class="st">"C:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>cns <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, eco_cns<span class="sc">$</span>CN, <span class="st">"'"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>cns <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(cns)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>eco_conds <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select * from COND where PLT_CN in ("</span>, cns, <span class="st">")"</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>eco_conds <span class="ot">&lt;-</span> <span class="fu">clean_na_cols</span>(eco_conds)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">append</span>(keep, <span class="st">"eco_conds"</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(eco_conds<span class="sc">$</span>PLT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13380</code></pre>
</div>
</div>
<hr>
<p>The field <em>CONDID</em> codes for the existence of more than one condition on a single plot. If a plot has more than one condition, then it will have more than one CONDID.</p>
<p>The field FORTYPCD being greater than one ensures that it is a measured forest plot?</p>
<ul>
<li>Subset the list to ensure that we have single condition plots.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>single_cond <span class="ot">&lt;-</span> eco_conds <span class="sc">|&gt;</span> <span class="fu">filter</span>(CONDPROP_UNADJ <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> FORTYPCD <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(single_cond<span class="sc">$</span>PLT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4400</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># eco_conds |&gt; select(PLT_CN, CONDID) |&gt; group_by(PLT_CN) |&gt; </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     n = n(), </span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     groups = "drop"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt; arrange(desc(n)) |&gt; head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond &lt;- eco_conds |&gt; select(PLT_CN, CONDID) |&gt; group_by(PLT_CN) |&gt; </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     n = n(), </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     groups = "drop"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt; filter(n == 1) |&gt; select(PLT_CN)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond &lt;- left_join(single_cond, eco_conds, join_by(PLT_CN))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><del>9,965</del>, 4,400 single condition plots with EcoRegions inside of the buffer, and of the current plot design.</p>
<hr>
<p>This section became redundant after Missoula.</p>
<ul>
<li>Filter out plots that are on Non-Forest land.</li>
</ul>
<p>2-38 of the FIA db users guide has a table that outlines the COND_STATUS_CD meanings.</p>
<ol type="1">
<li>Accessible forest land.</li>
<li>NonForest land, less than 10% cover.</li>
<li>NonCencus Water, small water bodies.</li>
<li>Census Water, large water bodies.</li>
<li>Nonsampled possibly forested.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond &lt;- single_cond |&gt; filter(</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   COND_STATUS_CD == 1 | COND_STATUS_CD == 2 | is.na(COND_STATUS_CD))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are 9,016 single condition plots that were sampled and were not water.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond |&gt; filter(</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   COND_STATUS_CD == 1 | is.na(COND_STATUS_CD)) |&gt; nrow()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Filter out plots that have artificial regeneration.</li>
</ul>
<p>2-45 of the FIA guide. STDORGCD is for natural (0) vs artificial (1) regeneration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond |&gt; filter(STDORGCD == 0 | is.na(STDORGCD)) |&gt; nrow()</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond |&gt; filter(STDORGCD == 0) |&gt; nrow()</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond &lt;- single_cond |&gt; filter(STDORGCD == 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>8,451 of those single condition plots are either coded as having natural regeneration or were not coded either way. 3,835 were coded as having Natural regeneration. I am proceeding with the larger subset.</p>
<hr>
<ul>
<li>Filter out plots that are coded as non-forest. i.e.&nbsp;Ag, Range, Beach, windbreak</li>
</ul>
<p>2.5.50 PRESNFCD is Present nonforest code. A code indicating the current nonforest land use for conditions that were previously classified as forest but are now classified as nonforest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond &lt;- single_cond |&gt; filter(is.na(PRESNFCD))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3,835 plots are not coded for non forest uses. That is the same number that were coded as having natural regen.</p>
<hr>
<section id="checking-the-kindcd" class="level4">
<h4 class="anchored" data-anchor-id="checking-the-kindcd">Checking the KindCD</h4>
<ul>
<li>Ensuring there are no periodic plots.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the PLOT table to see the KINDCD. </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>() , <span class="st">"C:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>wa_plot <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from PLOT"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>scns <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>single_plot <span class="ot">&lt;-</span> <span class="fu">left_join</span>(scns, wa_plot, <span class="fu">join_by</span>(PLT_CN <span class="sc">==</span> CN))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(single_plot<span class="sc">$</span>PLT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4400</code></pre>
</div>
</div>
<p>2.4.16 KINDCD is Sample kind code. A code indicating the type of plot installation. Database users may also want to examine DESIGNCD to obtain additional information about the kind of plot being</p>
<ol start="0" type="1">
<li>Periodic inventory plot.</li>
<li>Initial installation of a National design plot.</li>
<li>Remeasurement of previously installed National design plot.</li>
<li>Replacement of previously installed National design plot.</li>
<li>Modeled periodic inventory plot (Northeastern and North Central only).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>single_plot <span class="sc">|&gt;</span> <span class="fu">group_by</span>(KINDCD) <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">KINDCD</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2449</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1951</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are no periodic plots. The only KINDCD of plots are for Initial and Re-measurement plots.</p>
<p>No change from single_cond.</p>
<hr>
<ul>
<li>Filter out plots with fire damage.</li>
</ul>
<p>DSTRBCDs 1 - 3 are coded for fire as:</p>
<ol start="30" type="1">
<li>Fire prescribed or Natural</li>
<li>Ground Fire</li>
<li>Crown Fire</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>single_cond <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(DSTRBCD1 <span class="sc">!=</span> <span class="dv">30</span> <span class="sc">&amp;</span> DSTRBCD2 <span class="sc">!=</span> <span class="dv">30</span> <span class="sc">&amp;</span> DSTRBCD3 <span class="sc">!=</span> <span class="dv">30</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>single_cond <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(DSTRBCD1 <span class="sc">!=</span> <span class="dv">31</span> <span class="sc">&amp;</span> DSTRBCD2 <span class="sc">!=</span> <span class="dv">31</span> <span class="sc">&amp;</span> DSTRBCD3 <span class="sc">!=</span> <span class="dv">31</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>single_cond <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(DSTRBCD1 <span class="sc">!=</span> <span class="dv">32</span> <span class="sc">&amp;</span> DSTRBCD2 <span class="sc">!=</span> <span class="dv">32</span> <span class="sc">&amp;</span> DSTRBCD3 <span class="sc">!=</span> <span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dv">30</span> <span class="sc">%in%</span> <span class="fu">unique</span>(single_cond<span class="sc">$</span>DSTRBCD1) <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 31 %in% unique(single_cond$DSTRBCD1) |&gt; sort()</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 32 %in% unique(single_cond$DSTRBCD1) |&gt; sort()</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 30 %in% unique(single_cond$DSTRBCD2) |&gt; sort()</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 31 %in% unique(single_cond$DSTRBCD2) |&gt; sort()</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 32 %in% unique(single_cond$DSTRBCD2) |&gt; sort()</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 30 %in% unique(single_cond$DSTRBCD3) |&gt; sort()</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 31 %in% unique(single_cond$DSTRBCD3) |&gt; sort()</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 32 %in% unique(single_cond$DSTRBCD3) |&gt; sort()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(single_cond<span class="sc">$</span>PLT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4106</code></pre>
</div>
</div>
<p><del>3,552</del>, 4,106 plots that do not have fire damage.</p>
<hr>
<ul>
<li>Checking to see if these plots have trees.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cns <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>cns <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, cns<span class="sc">$</span>PLT_CN, <span class="st">"'"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>cns <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(cns)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>() , <span class="st">"C:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select * from TREE where PLT_CN in ("</span>, cns, <span class="st">")"</span>))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>seedlings <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select * from SEEDLING where PLT_CN in ("</span>, cns, <span class="st">")"</span>))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># names(seedlings)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># names(trees) |&gt; sort()</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">clean_na_cols</span>(trees)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> trees <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, <span class="at">TREECOUNT =</span> TPA_UNADJ, SPCD)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>seedlings <span class="ot">&lt;-</span> seedlings <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, TREECOUNT, SPCD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">add_row</span>(t, seedlings)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 195140</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(TREECOUNT))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 185211</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">group_by</span>(PLT_CN) <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">tpa =</span> <span class="fu">sum</span>(TREECOUNT))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">arrange</span>(tpa) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">PLT_CN</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">tpa</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">29883217010497</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.999188</td>
</tr>
<tr class="even">
<td style="text-align: left;">645308634126144</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.999188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">645308652126144</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">22398671010497</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.998376</td>
</tr>
<tr class="odd">
<td style="text-align: left;">40220519010497</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.998376</td>
</tr>
<tr class="even">
<td style="text-align: left;">48206161010497</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.998376</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4089</code></pre>
</div>
</div>
<p><del>3,531 of 3,552 plots have trees?</del> <del>There are also a bunch of records with NULL tpas. They are likely dead trees, at least the one I checked was dead.</del></p>
<p>4089 plot_cns with trees.</p>
<p>Second time through there were 3535 plots with trees that could be dead.</p>
<p><del>There could be plots that only have seedlings.</del></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tcns <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>cns <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>missing <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(cns, tcns, <span class="at">by =</span> <span class="st">"PLT_CN"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>missing <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>missing <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">PLT_CN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">12968112010497</td>
</tr>
<tr class="even">
<td style="text-align: left;">13040100010497</td>
</tr>
<tr class="odd">
<td style="text-align: left;">22398187010497</td>
</tr>
<tr class="even">
<td style="text-align: left;">22398198010497</td>
</tr>
<tr class="odd">
<td style="text-align: left;">22398362010497</td>
</tr>
<tr class="even">
<td style="text-align: left;">22954671010497</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>good_cns <span class="ot">&lt;-</span> <span class="fu">unique</span>(tcns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are 13 empty plots. I cannot find anything wrong with these plots. They simply do not have trees. After going back to look at the trees and changing some things there are 17. That means that there were 4 that only had dead trees.</p>
</section>
</section>
<section id="subplot-table." class="level1">
<h1>3. SubPlot Table.</h1>
<ul>
<li>control for microcond == subpcond.</li>
<li>control for near(SUBPCOND_PROP, 1, tol = .025) &amp; near(MICRCOND_PROP, 1, tol = .025)</li>
<li>control ecoregion !startsWith(FPAG, “A”) &amp; !startsWith(FPAG, “N”) &amp; !startsWith(FPAG, “W”)</li>
<li>fix ecoregion codes that were errors.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cns &lt;- single_cond |&gt; select(PLT_CN)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># single_plot &lt;- left_join(cns, single_plot, join_by(PLT_CN))</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># s_plot &lt;- single_plot |&gt; mutate(</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   FPAG = str_remove_all(str_sub(ECOSUBCD, 1, 4), " ")</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(is.na(s_plot$FPAG))</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># key &lt;- s_plot |&gt; select(PLT_CN, FPAG)</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># single_cond &lt;- left_join(key, single_cond, by = "PLT_CN")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="ot">&lt;-</span> single_cond <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">FPAG =</span> <span class="fu">str_remove_all</span>(<span class="fu">str_sub</span>(HABTYPCD1, <span class="dv">1</span>, <span class="dv">4</span>), <span class="st">" "</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>nofpag <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FPAG))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>nofpag <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 121</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4106</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(TRTCD1 <span class="sc">!=</span> <span class="dv">30</span> <span class="sc">&amp;</span> TRTCD2 <span class="sc">!=</span> <span class="dv">30</span> <span class="sc">&amp;</span> TRTCD3 <span class="sc">!=</span> <span class="dv">30</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fpag_cond &lt;- fpag_cond |&gt; filter(TRTCD1 != 31 &amp; DSTRBCD2 != 31 &amp; DSTRBCD3 != 31)</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fpag_cond &lt;- fpag_cond |&gt; filter(TRTCD1 != 32 &amp; DSTRBCD2 != 32 &amp; DSTRBCD3 != 32)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4075</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fpag_cond |&gt; group_by(TRTCD1, TRTCD2, TRTCD3) |&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(n = n())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4075 Plots on the second time through.</p>
<p>There are 104 CNs that do not have a habitat type code. Last time, I dropped them because we had more data.<br>
I could go into the veg tables and determine the proper code, but that might be laborious.</p>
<p>I am dropping them for now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(FPAG))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(fpag_cond<span class="sc">$</span>PLT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3959</code></pre>
</div>
</div>
<p>3959</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">append</span>(keep, <span class="fu">c</span>(<span class="st">"hab_key"</span>, <span class="st">"plots"</span>, <span class="st">"fpag_cond"</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_mem</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells 2494279 133.3    4075827 217.7  4075827 217.7
Vcells 5971227  45.6   60859319 464.4 73607829 561.6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>PLT_CN <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>PLT_CN <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, fpag_cond<span class="sc">$</span>PLT_CN, <span class="st">"'"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>PLT_CN <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(PLT_CN)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"c:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>zsubplot <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select * from subplot WHERE PLT_CN IN ("</span>, PLT_CN, <span class="st">")"</span>))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>zsubcond <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select * from subp_cond WHERE PLT_CN IN ("</span>, PLT_CN, <span class="st">")"</span>))</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>zsubcond <span class="ot">&lt;-</span> <span class="fu">clean_na_cols</span>(zsubcond)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>zsubplot <span class="ot">&lt;-</span> <span class="fu">clean_na_cols</span>(zsubplot)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(zsubcond)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15836</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(zsubplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15836</code></pre>
</div>
</div>
<p>13,792 subplots from 3,448 plots, all 4 subplots per plot were pulled.</p>
<p>15836 from 3959 on the second time through.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, CONDID, FPAG) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>zsubcond <span class="ot">&lt;-</span> <span class="fu">left_join</span>(t, zsubcond, <span class="fu">join_by</span>(PLT_CN, CONDID))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>zsubplot <span class="ot">&lt;-</span> zsubplot <span class="sc">|&gt;</span> <span class="fu">filter</span>(</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  (MICRCOND <span class="sc">==</span> SUBPCOND)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since they are all single condition plots, filtering for subplots where the microplot and subplot share the same condition produces the same number of plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> zsubcond <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">near</span>(SUBPCOND_PROP, <span class="dv">1</span>, <span class="at">tol =</span> .<span class="dv">025</span>) <span class="sc">&amp;</span> <span class="fu">near</span>(MICRCOND_PROP, <span class="dv">1</span>, <span class="at">tol =</span> .<span class="dv">025</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, they are all one condition, so they are all within a quarter percent of the same condition. Last time I did this, I filtered for this earlier in the process. I was under the impression that the FVS_PlotInit_Plot table was only composed of single condition stands and I joined the final filtering with that table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>zsubcond <span class="ot">&lt;-</span> zsubcond <span class="sc">|&gt;</span> <span class="fu">filter</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">startsWith</span>(FPAG, <span class="st">"A"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">startsWith</span>(FPAG, <span class="st">"N"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">startsWith</span>(FPAG, <span class="st">"W"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">filter</span>(</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">startsWith</span>(FPAG, <span class="st">"A"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">startsWith</span>(FPAG, <span class="st">"N"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">startsWith</span>(FPAG, <span class="st">"W"</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There were 2 stands removed here that were not removed by the earlier non-veg, water, and artificial filtering. Now there are 3,446 plots and 13,784 subplots.</p>
<p>15828 and 3957 on the second time through.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">append</span>(keep, <span class="fu">c</span>(<span class="st">"zsubcond"</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_mem</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used  (Mb) gc trigger  (Mb) max used  (Mb)
Ncells 2510697 134.1    4075827 217.7  4075827 217.7
Vcells 6281535  48.0   48687456 371.5 73607829 561.6</code></pre>
</div>
</div>
</section>
<section id="habitat-type-exploration" class="level1">
<h1>Habitat Type exploration</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(zsubcond<span class="sc">$</span>FPAG) <span class="sc">|&gt;</span> <span class="fu">noquote</span>() <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] CA   CAC1 CAC5 CACE CAF2 CAG1 CAG2 CAG3 CAS2 CAS3 CAS4 CC   CCF2 CCS2 CCS3
 [16] CD   CD13 CD61 CD63 CD81 CDF0 CDF4 CDG1 CDG2 CDG3 CDG6 CDRX CDS  CDS1 CDS2
 [31] CDS4 CDS6 cds7 CDS7 CDS8 CE   CE54 CEF2 CEF3 CEF4 CEFA CEFH CEG1 CEG2 CEG3
 [46] CEM2 CEM3 CERR CES  CES1 CES2 CES3 CES4 CES5 CF   CFF1 CFF2 CFF3 CFF4 CFM1
 [61] CFRR CFS1 CFS2 CFS3 CFS4 CFS5 CFS6 CFSC CH   CH12 CH21 CH6- CH62 CHC2 CHF1
 [76] CHF2 CHF4 CHF9 CHM1 CHS  CHS1 CHS2 CHS3 chs5 CHS5 CHS6 CHS7 CHS8 CL   CLM4
 [91] CLS2 CLS3 CLS4 CLS5 CM   CMF1 CMF2 CMG2 CMS1 CMS2 CMS3 CMS4 CMS5 CP   CPF0
[106] CPG1 CPG2 CPS0 CPS2 CPS3 CPS5 CSF2 CSF3 CW   CW33 CW55 CWC4 CWF0 CWF2 CWF3
[121] CWF4 CWG1 CWGI CWS2 CWS3 CWS5 HA   HBM1 HC   HO   HOG1 HOG2 HOG3 HOS3 HQ  
[136] HQG1 HQM2 HQS2 HX   PIAL SM20</code></pre>
</div>
</div>
<p>In the last iteration of this, I looked up the following plot in the tree and P2Veg tables to find the most likely Habitat type. I decided on a conifer/alpine/grass model.</p>
<p>Assuming that the 104 missing plots above have those data in the tables, that is what I would have to do to set habitat type for each one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixing the FPAG that was not entered correctly.</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>zsubcond <span class="ot">&lt;-</span> zsubcond <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FPAG =</span> <span class="fu">ifelse</span>(FPAG <span class="sc">==</span> <span class="st">"PIAL"</span>, <span class="st">"CAGO"</span>, FPAG)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">FPAG =</span> <span class="fu">ifelse</span>(FPAG <span class="sc">==</span> <span class="st">"PIAL"</span>, <span class="st">"CAGO"</span>, FPAG)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking at the descriptions for habitat type. </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>PLT_CN <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>PLT_CN <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, fpag_cond<span class="sc">$</span>PLT_CN, <span class="st">"'"</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>PLT_CN <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(PLT_CN)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>hab <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>hab <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, fpag_cond<span class="sc">$</span>HABTYPCD1, <span class="st">"'"</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>hab <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(hab)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"c:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>hab_key <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select HABTYPCD, PUB_CD, COMMON_NAME from REF_HABTYP_DESCRIPTION WHERE HABTYPCD IN ("</span>, hab, <span class="st">")"</span>))</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select * from PLOT WHERE CN IN ("</span>, PLT_CN, <span class="st">")"</span>))</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plots &lt;- clean_na_cols(plots)</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, HABTYPCD1, HABTYPCD1_PUB_CD) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>HABTYPCD1 <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">select</span>(HABTYPCD1) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">drop_na</span>()</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">left_join</span>(t, hab_key, <span class="fu">join_by</span>(HABTYPCD1 <span class="sc">==</span> HABTYPCD), <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) </span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">select</span>(HABTYPCD1, COMMON_NAME) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">group_by</span>(HABTYPCD1) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HABTYPCD1</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF221</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF221</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDG131</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDS627</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDS715</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CEF211</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>350 unique Habitat type codes come from the conditions table and 722 descriptions come from the reference table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(HABTYPCD1 <span class="sc">==</span> <span class="st">"CHF221"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HABTYPCD1</th>
<th style="text-align: left;">COMMON_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF221</td>
<td style="text-align: left;">western hemlock/sweet after death</td>
</tr>
<tr class="even">
<td style="text-align: left;">CHF221</td>
<td style="text-align: left;">Western hemlock/vanilla leaf-NWO Cascades</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHF221</td>
<td style="text-align: left;">W. hemlock/vanillaleaf</td>
</tr>
<tr class="even">
<td style="text-align: left;">CHF221</td>
<td style="text-align: left;">western hemlock/vanilla leaf</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(HABTYPCD1 <span class="sc">==</span> <span class="st">"CCF221"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HABTYPCD1</th>
<th style="text-align: left;">COMMON_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">western red cedar/bride’s bonnet</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">Western redcedar/Queencup beadlily</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">western red cedar/queencup beadlily</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Looking at a few of the many to many relationships by habitat type, they appear to be mostly just different spellings and minor species in the general area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>hab_key <span class="ot">&lt;-</span> hab_key <span class="sc">|&gt;</span> <span class="fu">select</span>(HABTYPCD, COMMON_NAME) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>hab_key <span class="ot">&lt;-</span> hab_key <span class="sc">|&gt;</span> <span class="fu">group_by</span>(HABTYPCD) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_row =</span> <span class="fu">row_number</span>()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>hab_key2 <span class="ot">&lt;-</span> hab_key <span class="sc">|&gt;</span> <span class="fu">filter</span>(n_row <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Accounting for multiple descriptions of each habitat, there are 308 descriptions in the reference data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> hab_key2 <span class="sc">|&gt;</span> <span class="fu">select</span>(HABTYPCD)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span>  HABTYPCD1 <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">HABTYPCD =</span> HABTYPCD1)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(y, x, <span class="fu">join_by</span>(HABTYPCD))<span class="sc">$</span>HABTYPCD <span class="sc">|&gt;</span> <span class="fu">noquote</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] CWF253   CES      CFS533   CH2135   chs513   CFS2-57  CDS      CFS1-51 
 [9] CFS333   CDS1813  CEFH23   CD811    CD132    CEFA23   CW5554   CDG231  
[17] SM20(1)  CH6-15   CHF1-25  CMS556   CHS34    CHS13    CHF1-24  CWGI21  
[25] CD639    CH625    CD6131   CHS235   CHF9     CACEF211 CHS1-26  cds715  
[33] CMS553   CHS261   CSF223   CHS      CE5426   CES351   CFS125   CSF352  
[41] CAC11    CHF138   PIAL     CDG639   CHS 7    CHS1 37  CES427   CH124   
[49] CW336    CES542  </code></pre>
</div>
</div>
<p>The 42 above Habitat types are in the conditions table, but not in the reference data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> hab_key <span class="sc">|&gt;</span> <span class="fu">filter</span>(n_row <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(HABTYPCD)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">left_join</span>(t, hab_key, <span class="at">by =</span> <span class="st">"HABTYPCD"</span>, <span class="at">relationship =</span> <span class="st">"many-to-many"</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>t  <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HABTYPCD</th>
<th style="text-align: left;">COMMON_NAME</th>
<th style="text-align: right;">n_row</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CAC1</td>
<td style="text-align: left;">subalpine larch</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC1</td>
<td style="text-align: left;">subalpine larch (Okanogan)</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAG112</td>
<td style="text-align: left;">whitebark pine/pinegrass</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAG112</td>
<td style="text-align: left;">whitebark pine</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">western red cedar/bride’s bonnet</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">Western redcedar/Queencup beadlily</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">western red cedar/queencup beadlily</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">western red cedar/bride’s bonnet</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">Western redcedar/Queencup beadlily</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF221</td>
<td style="text-align: left;">western red cedar/queencup beadlily</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDG123</td>
<td style="text-align: left;">Douglas-fir/kinnikinnick (Okanogan)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDG123</td>
<td style="text-align: left;">Douglas-fir/kinnikinnick</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">Douglas-fir/pinegrass (Okanogan and Colville)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">Douglas-fir/pinegrass</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">Douglas-fir/Pinegrass</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">Douglas-fir/pinegrass (Okanogan and Colville)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">Douglas-fir/pinegrass</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">Douglas-fir/Pinegrass</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDS411</td>
<td style="text-align: left;">Douglas-fir/Oregon boxleaf (Okanogan)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDS411</td>
<td style="text-align: left;">Douglas-fir/Oregon boxleaf</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Above are some of the set that have repeats.</p>
<section id="fpas" class="level2">
<h2 class="anchored" data-anchor-id="fpas">FPAs</h2>
<p>I don’t need to do this here, but I want to see what the descriptions look like for the FPAs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">clean_na_cols</span>()</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>fpag_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(FPAG) <span class="sc">|&gt;</span> <span class="fu">n_distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 141</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fpag_cond |&gt; names()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>138 unique FPAGs in this set of plots and subplots. They are single condition, so they are all the same per plot. 141 second time through.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting all of the ecoregion and FPA codes in one place. </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>fpas <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, HABTYPCD1, FPAG)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>fpas <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fpas, plots, <span class="fu">join_by</span>(PLT_CN <span class="sc">==</span> CN))</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>fpas <span class="ot">&lt;-</span> fpas <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, HABTYPCD1, FPAG, ECOSUBCD)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>fpas <span class="ot">&lt;-</span> fpas <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">FPA =</span> <span class="fu">str_remove_all</span>(</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(FPAG, <span class="dv">1</span>, <span class="dv">3</span>), </span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">" "</span>), </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">EcoRegion =</span> <span class="fu">str_remove_all</span>(</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(ECOSUBCD, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>), </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">" "</span>)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(PLT_CN, FPAG, FPA, EcoRegion)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>fpas <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">PLT_CN</th>
<th style="text-align: left;">FPAG</th>
<th style="text-align: left;">FPA</th>
<th style="text-align: left;">EcoRegion</th>
<th style="text-align: left;">HABTYPCD1</th>
<th style="text-align: left;">ECOSUBCD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">12964130010497</td>
<td style="text-align: left;">CWF4</td>
<td style="text-align: left;">CWF</td>
<td style="text-align: left;">M242C</td>
<td style="text-align: left;">CWF444</td>
<td style="text-align: left;">M242Ca</td>
</tr>
<tr class="even">
<td style="text-align: left;">12964449010497</td>
<td style="text-align: left;">CDS6</td>
<td style="text-align: left;">CDS</td>
<td style="text-align: left;">M242D</td>
<td style="text-align: left;">CDS675</td>
<td style="text-align: left;">M242Dg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12964657010497</td>
<td style="text-align: left;">CDS6</td>
<td style="text-align: left;">CDS</td>
<td style="text-align: left;">M242D</td>
<td style="text-align: left;">CDS638</td>
<td style="text-align: left;">M242Dh</td>
</tr>
<tr class="even">
<td style="text-align: left;">12965290010497</td>
<td style="text-align: left;">CDS6</td>
<td style="text-align: left;">CDS</td>
<td style="text-align: left;">M242D</td>
<td style="text-align: left;">CDS632</td>
<td style="text-align: left;">M242Df</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12965572010497</td>
<td style="text-align: left;">CAS3</td>
<td style="text-align: left;">CAS</td>
<td style="text-align: left;">M242D</td>
<td style="text-align: left;">CAS311</td>
<td style="text-align: left;">M242Db</td>
</tr>
<tr class="even">
<td style="text-align: left;">12965856010497</td>
<td style="text-align: left;">CDG1</td>
<td style="text-align: left;">CDG</td>
<td style="text-align: left;">M242D</td>
<td style="text-align: left;">CDG131</td>
<td style="text-align: left;">M242Dh</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(fpas<span class="sc">$</span>FPA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69</code></pre>
</div>
</div>
<p>68 unique FPAs, then 69.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(fpas<span class="sc">$</span>EcoRegion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "M242C" "M242D" "M242B" "M333A" "242A"  "342I" </code></pre>
</div>
</div>
<p>6, level 3 EcoRegions.</p>
<section id="descriptions" class="level3">
<h3 class="anchored" data-anchor-id="descriptions">descriptions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>hab_key2 <span class="ot">&lt;-</span> hab_key <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">FPA =</span> <span class="fu">str_remove_all</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(HABTYPCD, <span class="dv">1</span>, <span class="dv">3</span>), </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">" "</span>)) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> <span class="fu">select</span>(FPA, COMMON_NAME)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>hab_key2 <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">FPA</th>
<th style="text-align: left;">COMMON_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: left;">subalpine fir-mountain hemlock-whitebark pine (open parks)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">subalpine larch</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">subalpine larch (Okanogan)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">subalpine larch/western moss heather-partridgefoot</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">subalpine larch/common juniper</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">subalpine larch/Cascade bilberry-western moss heather</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> hab_key2 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(FPA) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">group_by</span>(FPA) <span class="sc">|&gt;</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">FPA</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDS</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHS</td>
<td style="text-align: right;">46</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMS</td>
<td style="text-align: right;">34</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWS</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: left;">CES</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFF</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CEF</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPS</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDG</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPG</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWG</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAG</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CLS</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CEG</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWF</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAS</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CEM</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">HOG</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCS</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDF</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHC</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CHM</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CMF</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMG</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HQS</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CD</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDR</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CE</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CER</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFR</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CH</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CL</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CLM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CP</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CW</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWC</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HBM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HC</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HO</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HOS</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HQ</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HQG</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HQM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HX</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">filter</span>(FPA <span class="sc">==</span> <span class="st">"CFS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 91%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">FPA</th>
<th style="text-align: left;">COMMON_NAME</th>
<th style="text-align: right;">row</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade barberry (Mt. Baker-Snoqualamie)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade barberry (Mount Baker-Snoqualamie)</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade barberry</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/dwarf Oregon grape</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/dwarf Oregongrape</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/salal (Gifford Pinchot)</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/salal</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/salal (Olympic)</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/salal-Cascade barberry</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir-noble fir/thinleaf huckleberry-rusty menziesia-Oregon boxleaf</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/common beargrass (Olympic)</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/common beargrass</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry (Olympic)</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry (Mt. Baker-Snoqualmie)</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/common beargrass (Olympic)</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/common beargrass</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/oneleaf foamflower</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry-Cascade barberry</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/bride’s bonnet</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/bride’s bonnet (Olympic)</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/Sitka valerian</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/twistedstalk</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry-oval-leaf blueberry</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/false lily of the valley</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/oneleaf foamflower</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/oneleaf foamflower (Mount Baker-Snoqualmie)</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/sidebells wintergreen</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/sidebells wintergreen</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry-salal (Mt. Baker-Snoqualmie)</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry-salal (Mount Baker-Snoqualmie)</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/western swordfern</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry (Wenatchee)</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/bride’s bonnet (Wenatchee)</td>
<td style="text-align: right;">34</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry-sidebells wintergreen</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/common beargrass</td>
<td style="text-align: right;">36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/blue huckleberry/beargrass</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/big huckleberry/beargrass</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/bunchberry dogwood</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/Alaska huckleberry/bunchberry</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/rusty menziesia</td>
<td style="text-align: right;">41</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/fool’s huckleberry</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/fools huckleberry</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry-salal</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Alaska huckleberry-salal</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/Alaska huckleberry-salal</td>
<td style="text-align: right;">46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/thinleaf huckleberry/bride’s bonnet</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/blue huckleberry/queencup beadlily</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/big huckleberry/beadily</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry (Mt. Baker-Snoqualmie)</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/oval-leaf blueberry/bride’s bonnet (Mt. Baker-Snoqualmie)</td>
<td style="text-align: right;">53</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir-noble fir/devilsclub</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/devilsclub</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/devil’s club</td>
<td style="text-align: right;">56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/devils club</td>
<td style="text-align: right;">57</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/devilsclub-oval-leaf blueberry</td>
<td style="text-align: right;">58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/roughfruit berry (Wenatchee)</td>
<td style="text-align: right;">59</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir-noble fir/Cascade’s Azalea</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/rusty menziesia (Wenatchee)</td>
<td style="text-align: right;">61</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade azalea (Gifford Pinchot)</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade azalea</td>
<td style="text-align: right;">63</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade azalea/common beargrass</td>
<td style="text-align: right;">64</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Silver fir/azalea/beargrass</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade azalea-thinleaf huckleberry</td>
<td style="text-align: right;">66</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade azalea-oval-leaf blueberry</td>
<td style="text-align: right;">67</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/Cascade azalea-thinleaf huckleberry (Wenatche)</td>
<td style="text-align: right;">68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/vine maple</td>
<td style="text-align: right;">69</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: left;">Pacific silver fir/shrub (cool)</td>
<td style="text-align: right;">70</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="trying-sci-names" class="level1">
<h1>Trying sci names</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>hab <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>hab <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, fpag_cond<span class="sc">$</span>HABTYPCD1, <span class="st">"'"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>hab <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(hab)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"c:/RxFire/Data/_FIADB_WA.db"</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>hab_key <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="fu">str_c</span>(<span class="st">"select HABTYPCD, PUB_CD, SCIENTIFIC_NAME, COMMON_NAME from REF_HABTYP_DESCRIPTION WHERE HABTYPCD IN ("</span>, hab, <span class="st">")"</span>))</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>hab_key <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 17%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">HABTYPCD</th>
<th style="text-align: left;">PUB_CD</th>
<th style="text-align: left;">SCIENTIFIC_NAME</th>
<th style="text-align: left;">COMMON_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: left;">639</td>
<td style="text-align: left;">ABLA-TSME-PIAL</td>
<td style="text-align: left;">subalpine fir-mountain hemlock-whitebark pine (open parks)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC1</td>
<td style="text-align: left;">609</td>
<td style="text-align: left;">LALY</td>
<td style="text-align: left;">subalpine larch</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAC1</td>
<td style="text-align: left;">639</td>
<td style="text-align: left;">LALY</td>
<td style="text-align: left;">subalpine larch (Okanogan)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC111</td>
<td style="text-align: left;">626</td>
<td style="text-align: left;">LALY/CAME7-LUPE</td>
<td style="text-align: left;">subalpine larch/western moss heather-partridgefoot</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAC111</td>
<td style="text-align: left;">639</td>
<td style="text-align: left;">LALY/CAME7-LUPE</td>
<td style="text-align: left;">subalpine larch/western moss heather-partridgefoot</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC113</td>
<td style="text-align: left;">626</td>
<td style="text-align: left;">LALY/JUCO6</td>
<td style="text-align: left;">subalpine larch/common juniper</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>hab_key2 <span class="ot">&lt;-</span> hab_key <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">FPA =</span> <span class="fu">str_remove_all</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(HABTYPCD, <span class="dv">1</span>, <span class="dv">3</span>), </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">" "</span>)) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> <span class="fu">select</span>(FPA, SCIENTIFIC_NAME) </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 722 rows</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>hab_key2 <span class="ot">&lt;-</span> hab_key2 <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 295 rows</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>hab_key2 <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">FPA</th>
<th style="text-align: left;">SCIENTIFIC_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">CA</td>
<td style="text-align: left;">ABLA-TSME-PIAL</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">LALY</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">LALY/CAME7-LUPE</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">LALY/JUCO6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">LALY/VADE-CAME7</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: left;">CAC</td>
<td style="text-align: left;">LALY/VASC/LUGLH</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> hab_key2 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(FPA) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> <span class="fu">group_by</span>(FPA) <span class="sc">|&gt;</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">FPA</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CDS</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFS</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHS</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMS</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWS</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">CES</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDG</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CEF</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFF</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPS</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAC</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAG</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CLS</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPG</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCF</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWF</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">CWG</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAS</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CEG</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CEM</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">HOG</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCS</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDF</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CHC</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMF</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CMG</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">HQS</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CD</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CDR</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CE</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CER</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFR</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CH</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CHM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CL</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CLM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CP</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPF</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CW</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CWC</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HBM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HC</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HO</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HOS</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HQ</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HQG</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HQM</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HX</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">filter</span>(FPA <span class="sc">==</span> <span class="st">"CDS"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>SCIENTIFIC_NAME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "PSME/ARPA"            "PSME/HODI/2GRAM"      "PSME/HODI/Grass"     
 [4] "PSME/HODI/GRASS"      "PSME/HODI/CAGE2"      "PSME/ACCI/FEOC"      
 [7] "PSME/GASH"            "PSME/PAMY"            "PSME/PAMY/CARU"      
[10] "PSME/SPIRA-SYAL-ARUV" "PIPO-PSME/SYAL-HODI"  "PSME/HODI"           
[13] "PIPO-PSME/HODI"       "2TE/SYAL/2FORB"       "PSME-ABCO/SYAL/2FORB"
[16] "PSME/SYAL"            "PSME/SYOR-WEN"        "PSME/SYOR2"          
[19] "PSME/SPBE2"           "PSME/SYAL/PSSPS"      "PSME/SYAL/CARU"      
[22] "PSME/SPBEL/CARU"      "PSME/SPBEL"           "PSME/ARUV"           
[25] "PSME/ARUV-PUTR2"      "PSME/ARUV/CARU"       "PSME/ARNE"           
[28] "PSME/PUTR2"           "PSME/PUTR"            "PSME/PUTR2/PSSPS"    
[31] "PSME/PUTR2/CARU"      "PSME/PHMA5"           "PSME/PHMA"           
[34] "PSME/PHMA5/LIBOL2"    "PSME/VACCI"           "PSME/VAME"           
[37] "PSME/VACA13"          "PSME/VAMY"            "PSME/VAMY/CARU"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> t <span class="sc">|&gt;</span> <span class="fu">filter</span>(FPA <span class="sc">==</span> <span class="st">"CCF"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>SCIENTIFIC_NAME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "THPL/ACTR"  "THPL/CLUN2" "THPL/CLUN"  "THPL/ARNU2"</code></pre>
</div>
</div>
<p>The Scientific names are less variable. The plant associations of a couple of FPAs are pretty variable. However, the major tree species is mostly consistent. Most of the variability comes from the understory as we exprected. I am not sure if there is a good way to capture variability in FPA regeneration for these varying plant associations.</p>
</section>
<section id="save" class="level1">
<h1>Save</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These are the correct plots to save</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> zsubcond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> fpag_cond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co"># anti_join(x,t,join_by(PLT_CN))</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># anti_join(t,x,join_by(PLT_CN))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>1_Import_Clean.csv</p>
<p>I want to save the PLT_CN, Subplot_cn, and FPAG for these plots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> zsubcond <span class="sc">|&gt;</span> <span class="fu">select</span>(PLT_CN, SUBP, FPAG) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">STANDPLOT_CN =</span> <span class="fu">str_c</span>(PLT_CN, <span class="st">"_"</span>, SUBP)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>SUBP)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/RxFire/Regen/Regeneration_2_16Sept24"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write_csv(filtered, "./1_Import_Clean2.csv")</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(filtered<span class="sc">$</span>PLT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3957</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(filtered<span class="sc">$</span>STANDPLOT_CN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15828</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/KingBlkMouth\.github\.io\/Regen_Regression\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>