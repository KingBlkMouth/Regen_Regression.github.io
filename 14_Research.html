<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Research – Regen 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Regen 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./1.0_Import_Clean.html"> 
<span class="menu-text">Data Prep</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./9_RF_Regression.html"> 
<span class="menu-text">Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./6_distributions.html"> 
<span class="menu-text">Plots</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./10_Hyperparameters.html"> 
<span class="menu-text">Parameters</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./11_Heatmap.html"> 
<span class="menu-text">Maps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./14_Research.html" aria-current="page"> 
<span class="menu-text">Other</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./14_Research.html">Research</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_Research.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Research</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_Personal_Notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Personal Notes</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fia-variables" id="toc-fia-variables" class="nav-link active" data-scroll-target="#fia-variables">FIA Variables</a>
  <ul class="collapse">
  <li><a href="#plot-table" id="toc-plot-table" class="nav-link" data-scroll-target="#plot-table">PLOT table</a>
  <ul class="collapse">
  <li><a href="#water" id="toc-water" class="nav-link" data-scroll-target="#water">Water</a></li>
  <li><a href="#visits-and-sampling" id="toc-visits-and-sampling" class="nav-link" data-scroll-target="#visits-and-sampling">Visits and Sampling</a></li>
  <li><a href="#hexagons" id="toc-hexagons" class="nav-link" data-scroll-target="#hexagons">Hexagons</a></li>
  </ul></li>
  <li><a href="#cond-table" id="toc-cond-table" class="nav-link" data-scroll-target="#cond-table">COND table</a>
  <ul class="collapse">
  <li><a href="#water-1" id="toc-water-1" class="nav-link" data-scroll-target="#water-1">Water</a></li>
  </ul></li>
  <li><a href="#subp-regen-table" id="toc-subp-regen-table" class="nav-link" data-scroll-target="#subp-regen-table">SUBP Regen Table</a></li>
  <li><a href="#seedling-regeneration-table" id="toc-seedling-regeneration-table" class="nav-link" data-scroll-target="#seedling-regeneration-table">Seedling Regeneration Table</a></li>
  <li><a href="#ground-cover-table" id="toc-ground-cover-table" class="nav-link" data-scroll-target="#ground-cover-table">Ground Cover Table</a></li>
  <li><a href="#subplot-soil-sample-layer-table" id="toc-subplot-soil-sample-layer-table" class="nav-link" data-scroll-target="#subplot-soil-sample-layer-table">Subplot Soil Sample Layer Table</a></li>
  <li><a href="#population-tables" id="toc-population-tables" class="nav-link" data-scroll-target="#population-tables">Population tables</a></li>
  <li><a href="#plot-geometry-table" id="toc-plot-geometry-table" class="nav-link" data-scroll-target="#plot-geometry-table">Plot Geometry Table</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">————————–</a></li>
  <li><a href="#treemap-bootstrap" id="toc-treemap-bootstrap" class="nav-link" data-scroll-target="#treemap-bootstrap">TreeMap Bootstrap</a>
  <ul class="collapse">
  <li><a href="#treemap-code" id="toc-treemap-code" class="nav-link" data-scroll-target="#treemap-code">TreeMap Code</a>
  <ul class="collapse">
  <li><a href="#part-1" id="toc-part-1" class="nav-link" data-scroll-target="#part-1">Part 1</a></li>
  <li><a href="#part-2" id="toc-part-2" class="nav-link" data-scroll-target="#part-2">Part 2</a></li>
  </ul></li>
  <li><a href="#function-lookup" id="toc-function-lookup" class="nav-link" data-scroll-target="#function-lookup">Function Lookup</a></li>
  <li><a href="#pseudo-code" id="toc-pseudo-code" class="nav-link" data-scroll-target="#pseudo-code">Pseudo-Code</a>
  <ul class="collapse">
  <li><a href="#part-1-1" id="toc-part-1-1" class="nav-link" data-scroll-target="#part-1-1">Part 1</a></li>
  <li><a href="#part-2-1" id="toc-part-2-1" class="nav-link" data-scroll-target="#part-2-1">Part 2</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">——————————-</a></li>
  <li><a href="#john-shaw-sqlite" id="toc-john-shaw-sqlite" class="nav-link" data-scroll-target="#john-shaw-sqlite">John Shaw, SQLite</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">——————————-</a></li>
  <li><a href="#git" id="toc-git" class="nav-link" data-scroll-target="#git">Git</a></li>
  <li><a href="#end" id="toc-end" class="nav-link" data-scroll-target="#end">END</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This page consists of various research tasks. See sections titles for task descriptions.</p>
<p><em>Libraries</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())                                                      </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()                                                                                 </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Data tidying and acces</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> T)       <span class="co"># Easy to read syntax and data manipulation                   </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSQLite)                      <span class="co"># Access SQLite dbs   </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)                     <span class="co"># Pipes and math functions    </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(readxl)                     # Read xlsx </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(writexl)                    # write xlsx     </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                                   </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># yaImpute and related                           </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># library(randomForest)                 # RF package that yaImpute uses</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># library(yaImpute)                     # RF imputation</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(vegan)                        # Something to do the yaImpute</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                                                     </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plots and tables                          </span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># library(esquisse)                     # Quick data visualization   </span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># library(knitr)                        # Better html tables</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># library(DT)                           # Data tables for Java script tables in HTML</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># library(stars)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># library(kableExtra)                   # Better html tables, change sizes</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># library(feather)                      # Faster data retrieval    </span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Geography</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># library(sf)                           # Simple Features/vector data</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># library(terra)                        # Raster functions</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># library(spatstat)                     # Spatial stats</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tcltk)                        <span class="co"># Fix file paths</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># No sci-notation. </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width =</span> <span class="dv">125</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Functions</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>clean_mem <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">ls</span>(<span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ls()[!(ls() %in% keep)]</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> x[<span class="sc">!</span>(x <span class="sc">%in%</span> keep)], <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>clean_na_cols <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(df)) <span class="sc">&lt;</span> <span class="fu">nrow</span>(df)]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># path &lt;- r"(C:\RxFire\Regen\FVS\regen_080724_1644\regen_080724_1644.db)"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>clean_paths <span class="ot">&lt;-</span> <span class="cf">function</span>(path) {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(path, <span class="st">"</span><span class="sc">\\\\</span><span class="st">"</span>, <span class="st">"/"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>db_list <span class="ot">&lt;-</span> <span class="cf">function</span>(df, CN_col){</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">select</span>({{CN_col}})</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> name <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">CN_col =</span> <span class="fu">str_c</span>(<span class="st">"'"</span>, {{CN_col}}, <span class="st">"'"</span>)) </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(name<span class="sc">$</span>CN_col)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># name &lt;- str_flatten_comma(name[, CN_col])</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  name</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>nas_to_zeroes <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>rmsd_spp <span class="ot">&lt;-</span>spprmsd_spp <span class="ot">&lt;-</span> <span class="cf">function</span>(imp_df, spp) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  rmsd_t <span class="ot">&lt;-</span> imp_df <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(spp)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"TD"</span>))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  v1 <span class="ot">&lt;-</span> rmsd_t <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"TD"</span>)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  v2 <span class="ot">&lt;-</span> rmsd_t <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">".o"</span>)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  rmsd_t <span class="ot">&lt;-</span> rmsd_t <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sq_dev =</span> (rmsd_t[,v1] <span class="sc">-</span> rmsd_t[,v2])<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>(rmsd_t<span class="sc">$</span>sq_dev)))</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"keep"</span>, <span class="st">"clean_mem"</span>, <span class="st">"clean_na_cols"</span>, <span class="st">"clean_paths"</span>, <span class="st">"db_list"</span>, <span class="st">"nas_to_zeroes"</span>, <span class="st">"rmsd_spp"</span>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p><strong>Created on</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-10-01 11:56:23 PDT"</code></pre>
</div>
</div>
<p><strong>Last updated on</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-10-09 14:00:20 PDT"</code></pre>
</div>
</div>
<hr>
<section id="fia-variables" class="level1">
<h1>FIA Variables</h1>
<p>Here I am looking for FIA variables that could be used to indicate soil type and water availability.</p>
<p>Looking in the FIA database, data description and user guide for phase 2 version 9.2.</p>
<p><a href="https://research.fs.usda.gov/understory/forest-inventory-and-analysis-database-user-guide-nfi">Users Guide</a></p>
<p>I am using ctrl + f to search for water and soil. Also, I’m looking at tables that I have never had the oportunity look at before.</p>
<section id="plot-table" class="level2">
<h2 class="anchored" data-anchor-id="plot-table">PLOT table</h2>
<section id="water" class="level3">
<h3 class="anchored" data-anchor-id="water">Water</h3>
<ul>
<li>2.4.19 <em>WATERCD</em>,</li>
</ul>
<p>Water on plot code. Water body &lt;1 acre in size or a stream &lt;30 feet wide that has the greatest impact on the area within the sampled portions of any of the four subplots. The coding hierarchy is listed in order from large permanent water to temporary water. May not be populated for some FIA work units. + 0 None - no water sources within the sampled condition class(es). + 1 Permanent streams or ponds too small to qualify as noncensus water. + 2 Permanent water in the form of deep swamps, bogs, marshes without standing trees present and less than 1.0 acre in size, or with standing trees. + 3 Ditch/canal - human-made channels used as a means of moving water, e.g., for irrigation or drainage, which are too small to qualify as noncensus water. + 4 Temporary streams. + 5 Flood zones - evidence of flooding when bodies of water exceed their natural banks. + 9 Other temporary water.</p>
</section>
<section id="visits-and-sampling" class="level3">
<h3 class="anchored" data-anchor-id="visits-and-sampling">Visits and Sampling</h3>
<p>This could be a good code to use in filtering, if it is filled for all plots.</p>
<ul>
<li>2.4.41 <em>SAMP_METHOD_CD</em>,</li>
</ul>
<p>Sample method code. A code indicating if the plot was observed in the field or remotely sensed in the office. 1 = Field visited, meaning a field crew physically examined the plot and recorded information at least about subplot 1 center condition (see SUBP_EXAMINE_CD below) + When the plot is sampled remotely, the number of subplots examined (SUBP_EXAMINE_CD) usually equals 1.</p>
<ul>
<li>2.4.42 <em>SUBP_EXAMINE_CD</em>,</li>
</ul>
<p>Subplots examined code. A code indicating the number of subplots examined. By default, PLOT_STATUS_CD = 1 plots have all 4 subplots examined. 4 = All four subplots fully described (no assumptions/inferences).</p>
<ul>
<li><p>1.2.1 Sampling, <strong>Phase 1 (P1) is used for stratification, while Phase 2 (P2) consists of plots that are visited or photo-interpreted.</strong></p></li>
<li><p>2.4.11 <em>PLOT_NONSAMPLE_REASN_CD</em></p></li>
</ul>
<p>Plot nonsampled reason code. A code indicating the reason an entire plot was not sampled. 1-11 = not-sampled. Perhaps NULL indicates sampled.</p>
<ul>
<li>2.4.50 <em>NF_PLOT_STATUS_CD</em>,</li>
</ul>
<p>Nonforest plot status code. A code describing the sampling status of the nonforest plot. 1 = Sampled at least one accessible nonforest land condition present on the plot.</p>
</section>
<section id="hexagons" class="level3">
<h3 class="anchored" data-anchor-id="hexagons">Hexagons</h3>
<p>Emap hexagons are not the hexagons that outline FIA plots for large area estimation. The hexagons refered to in Intesity are the ones that I needed for the error map.</p>
<ul>
<li>2.4.40 <em>EMAP_HEX</em>,</li>
</ul>
<p>EMAP hexagon. The identifier for the approximately 160,000 acre Environmental Monitoring and Assessment Program (EMAP) hexagon in which the plot is located. EMAP hexagons are available to the public, cover the coterminous United States, and have been used in summarizing and aggregating data about numerous natural resources.</p>
<ul>
<li>2.4.44 <em>INTENSITY</em>,</li>
</ul>
<p>Intensity. A code used to identify Federal base grid annual inventory plots and plots that have been added to intensify a particular sample. Under the Federal base grid, one plot is collected in each theoretical hexagonal polygon, which is slightly more than 5,900 acres in size. Plots with INTENSITY = 1 are part of the Federal base grid. In some instances, States and/or agencies have provided additional support to increase the sampling intensity for an area. Supplemental plots have INTENSITY set to higher numbers depending on the amount of plot intensification chosen for the particular estimation unit. Populated when MANUAL 1.0.</p>
</section>
</section>
<section id="cond-table" class="level2">
<h2 class="anchored" data-anchor-id="cond-table">COND table</h2>
<ul>
<li>2.5.9 <em>COND_STATUS_CD</em>,</li>
</ul>
<p>Condition status code. A code indicating the basic land classification.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="C:/RxFire/Regen/Regeneration_2_16Sept24/Images/COND_STATUS_CD_Table.png" class="img-fluid figure-img"></p>
<figcaption>Cond Status cd</figcaption>
</figure>
</div>
<ul>
<li>2.5.159 <em>FOREST_COND_STATUS_CHANGE_CD</em>,</li>
</ul>
<p>Forest land condition status change code. A code indicating change in forest land condition.</p>
<ul>
<li>3.1.27 <em>AGENTCD</em>, Cause of death (agent) code. (core: all remeasured plots when the tree was alive at the previous visit and at revisit is dead or removed OR the tree is standing dead in the current inventory and the tree is ingrowth, through growth, or a missed live tree; core optional: all initial plot visits when tree qualifies as a mortality tree) When PLOT.MANUAL 1.0, this attribute was collected on only dead and cut trees. When PLOT.MANUAL &lt;1.0, this attribute was collected on all trees (live, dead, and cut). Cause of damage was recorded for live trees if the presence of damage or pathogen activity was serious enough to reduce the quality or vigor of the tree. When a tree was damaged by more than one agent, the most severe damage was coded. When no damage was observed on a live tree, 00 was recorded. Damage recorded for dead trees was the cause of death. Each FIA program records specific codes that may differ from one State to the next. These codes fall within the ranges listed below. For the specific codes used in a particular State, contact the FIA work unit responsible for that State (table 1-1).
<ul>
<li>30 = Fire</li>
<li>00 = No agent recorded (only allowed on live trees in data prior to 1999).</li>
</ul></li>
</ul>
<section id="water-1" class="level3">
<h3 class="anchored" data-anchor-id="water-1">Water</h3>
<p>2.5.35 <em>PHYSCLCD</em>,</p>
<p>Physiographic class code. A code indicating the general effect of land form, topographical position, and soil on moisture available to trees. +Note: When PLOT.MANUAL &lt;1.0, this attribute is populated for all forest periodic plots and all NCRS periodic plots that were measured as “nonforest with trees” (e.g., wooded pasture, windbreaks).</p>
<p>Xeric sites (normally low or deficient in available moisture)</p>
<ul>
<li>11 Dry Tops - Ridge tops with thin rock outcrops and considerable exposure to sun and wind.</li>
<li>12 Dry Slopes - Slopes with thin rock outcrops and considerable exposure to sun and wind. Includes most mountain/steep slopes with a southern or western exposure.</li>
<li>13 Deep Sands - Sites with a deep, sandy surface subject to rapid loss of moisture following precipitation. Typical examples include sand hills, ridges, and flats in the South, sites along the beach and shores of lakes and streams.</li>
<li>19 Other Xeric - All dry physiographic sites not described above.</li>
</ul>
<p>Mesic sites (normally moderate but adequate available moisture)</p>
<ul>
<li>21 Flatwoods - Flat or fairly level sites outside of floodplains. Excludes deep sands and wet, swampy sites.</li>
<li>22 Rolling Uplands - Hills and gently rolling, undulating terrain and associated small streams. Excludes deep sands, all hydric sites, and streams with associated floodplains.</li>
<li>23 Moist Slopes and Coves - Moist slopes and coves with relatively deep, fertile soils. Often these sites have a northern or eastern exposure and are partially shielded from wind and sun. Includes moist mountain tops and saddles.</li>
<li>24 Narrow floodplains/Bottomlands - Floodplains and bottomlands less than 1/4 mile in width along rivers and streams. These sites are normally well drained but are subjected to occasional flooding during periods of heavy or extended precipitation. Includes associated levees, benches, and terraces within a 1/4 mile limit. Excludes swamps, sloughs, and bogs.</li>
<li>25 Broad Floodplains/Bottomlands - Floodplains and bottomlands 1/4/-mile or wider along rivers and streams. These sites are normally well drained but are subjected to occasional flooding during periods of heavy or extended precipitation. Includes associated levees, benches, and terraces. Excludes swamps, sloughs, and bogs with year-round water problems.</li>
<li>29 Other Mesic - All moderately moist physiographic sites not described above.</li>
</ul>
<p>Hydric sites (normally abundant or overabundant moisture all year)</p>
<ul>
<li>31 Swamps/Bogs - Low, wet, flat, forested areas usually quite extensive that are flooded for long periods except during periods of extreme drought. Excludes cypress ponds and small drains.</li>
<li>32 Small Drains - Narrow, stream-like, wet strands of forest land often without a well-defined stream channel. These areas are poorly drained or flooded throughout most of the year and drain the adjacent higher ground.</li>
<li>33 Bays and wet pocosins - Low, wet, boggy sites characterized by peaty or organic soils. May be somewhat dry during periods of extended drought. Examples include sites in the Carolina bays in the Southeast United States.</li>
<li>34 Beaver ponds.</li>
<li>35 Cypress ponds.</li>
<li>39 Other hydric - All other hydric physiographic sites.</li>
</ul>
<p>2.5.131 <em>FOREST_COMMUNITY_PNWRS</em>,</p>
<p>Forest type (Pacific Islands), Pacific Northwest Research Station. A code indicating the forest type that best describes the species with the plurality of crown cover for all live trees in the condition class that are not overtopped. Recorded for all accessible forest land condition classes in the Pacific Islands. Only populated by certain FIA work units (SURVEY.RSCD = 26). + Note: Pacific Island forest types are taken from Mueller-Dombois and Fosberg (1998).</p>
<ul>
<li>1 Strand or halophytic vegetation - vegetation near the shore containing species adapted to high rates of evaporation by wind and to high salt concentrations from windblown ocean spray or inundation by salt water.</li>
<li>2 Mangrove swamps - trees with high salt tolerance growing on tidally inundated shores and in landlocked depressions. Many species have pneumatophores, adaptive structures for aeration of waterlogged root systems.</li>
<li>3 Lowland tropical rainforest - multistoried forest with many canopydwelling epiphytes, open ground, and shrub layers. This forest community can extend up the lower slopes with windward rainy exposures.</li>
<li>4 Montane rainforest -the predominant type on moist hilltops and mountain slopes in many tropical islands. Forests of low stature that are rich in shrubs and epiphytes.</li>
<li>5 Cloud forest - These forests are covered with clouds or fog much of the time. The trees have low canopies and are often dripping with moisture. The trees are typically small-leafed and covered with masses of epiphytic mosses and liverworts, which also form a deep ground cover.</li>
<li>6 Mesophytic or moist forest - seasonally dry evergreen forests on leeward, drier slopes.</li>
<li>7 Xerophytic - forests found on truly dry, rain-shadow, leeward mountain slopes and lowlands.</li>
<li>8 Agroforestry - tree species are included in crop or animal production agricultural ecosystems.</li>
<li>9 Plantations - an area planted with tree species for the purpose of timber production. Species planted are mainly eucalypt, mahogany, and pine species that replace indigenous forests and savannas.</li>
</ul>
</section>
</section>
<section id="subp-regen-table" class="level2">
<h2 class="anchored" data-anchor-id="subp-regen-table">SUBP Regen Table</h2>
<ul>
<li>6.2.10 <em>REGEN_SUBP_STATUS_CD</em>,</li>
</ul>
<p>Regeneration subplot status code. A code indicating whether or not the subplot was sampled for advanced regeneration. This attribute was retired starting with INVYR = 2015. Data for all years are now populated in REGEN_MICR_STATUS_CD.</p>
<ul>
<li>6.2.12 <em>SUBPLOT_SITE_LIMITATIONS</em>,</li>
</ul>
<p>Subplot site limitations. A code indicating if the site has a limitation on at least 30 percent of the accessible forest area of the subplot that would inhibit or preclude the presence of regenerating seedlings. This attribute was retired starting with INVYR = 2015. Note: For INVYR &lt;2015, the field guide referenced the sampling unit as the subplot even though seedlings are and have only been counted on the microplots.</p>
<ul>
<li><p>1 No site limitation.</p></li>
<li><p>2 Rocky surface with little or no soil.</p></li>
<li><p>3 Water-saturated soils (during the growing season).</p></li>
<li><p>6.2.13 <em>MICROPLOT_SITE_LIMITATIONS</em>,</p></li>
</ul>
<p>Microplot site limitations. A code indicating if the site has a limitation on at least 30 percent of the accessible forest area of the microplot that would inhibit or preclude the presence of regenerating seedlings. + Same codes as above.</p>
<ul>
<li>6.2.22 <em>REGEN_MICR_STATUS_CD</em>,</li>
</ul>
<p>Regeneration microplot status code. A code indicating whether the microplot was sampled for advanced regeneration. Based on the procedures described in Bechtold and Patterson (2005), POP_STRATUM.ADJ_FACTOR_REGEN_MICR should be applied when making population estimates. This compensates for any nonsampled microplots or cases where the sampling status is ambiguous (codes 3 through 9).</p>
<ul>
<li>1 Advance regeneration sampled - accessible forest land condition present on the microplot.</li>
<li>2 Advance regeneration sampled - no accessible forest land condition present on the microplot.</li>
<li>3 Advance regeneration nonsampled - accessible forest land condition present on the microplot, but advance regeneration variables cannot be assessed (core SEEDLING.TREECOUNT is still measured).</li>
<li>4 Advance regeneration nonsampled - QA/QC did not measure subplot/microplot for tree/sapling/seedling data (PLOT.QA_STATUS = 2-5 only).</li>
<li>5 Nonsampled - subplot not sampled (SUBPLOT.SUBP_STATUS_CD = 3).</li>
<li>9 Advance regeneration sample status is ambiguous - collected under earlier, more general definition; refer to REGEN_SUBP_STATUS_CD.</li>
</ul>
</section>
<section id="seedling-regeneration-table" class="level2">
<h2 class="anchored" data-anchor-id="seedling-regeneration-table">Seedling Regeneration Table</h2>
<p>6.3.14 <em>SEEDLING_SOURCE_CD</em>,</p>
<p>Seedling source code. A code indicating the source of the seedlings</p>
<ul>
<li>1 Other seedling.</li>
<li>2 Stump sprout.</li>
<li>3 Competitive oak, hickory, or butternut seedling (Note: Research indicates that competitive seedlings are highly likely to become dominant or codominant stems in the next stand during forest succession. To be classified as competitive, stems must have a root collar diameter [d.r.c.] &gt;0.75 inches or have a length of at least 3 feet. In situations with relatively high tally, it should only be necessary to check at least 10% of d.r.c.’s.)</li>
</ul>
<p>6.3.15 <em>LENGTH_CLASS_CD</em>,</p>
<p>Length class code. A code indicating the length class of the seedlings.</p>
<ul>
<li>1, 2 inches to less than 6 inches.</li>
<li>2, 6 inches to less than 12 inches.</li>
<li>3, 1 foot to less than 3 feet.</li>
<li>4, 3 feet to less than 5 feet.</li>
<li>5, 5 feet to less than 10 feet.</li>
<li>6, Greater than or equal to 10 feet.</li>
</ul>
</section>
<section id="ground-cover-table" class="level2">
<h2 class="anchored" data-anchor-id="ground-cover-table">Ground Cover Table</h2>
<p>7.1.12 <em>GRND_CVR_TYP</em>,</p>
<p>Ground cover type. A code indicating the ground cover type found on each transect segment. If multiple ground cover types (e.g., BARE, LITT, ROCK) are present on a segment, a separate record is populated for each category. Individual categories add up to 100 percent for each 10-foot segment along the transect.</p>
</section>
<section id="subplot-soil-sample-layer-table" class="level2">
<h2 class="anchored" data-anchor-id="subplot-soil-sample-layer-table">Subplot Soil Sample Layer Table</h2>
<p><strong>Look at this table. It has soil moisture measurements, but I am not sure that the sampling procedure will be helpful.</strong> <strong>If there are samples on our CNs, then it is worth looking at this further</strong></p>
<ul>
<li>8.2.29 <em>TEXTURE_CD</em>,</li>
</ul>
<p>Texture code. A code indicating the texture of the soil layer.</p>
<ul>
<li>0, Organic.</li>
<li>1, Loamy.</li>
<li>2, Clayey.</li>
<li>3, Sandy.</li>
<li>4, Coarse sand.</li>
<li>9, Not measured.</li>
</ul>
<p>There are a bunch of codes for ph and nutrients.</p>
</section>
<section id="population-tables" class="level2">
<h2 class="anchored" data-anchor-id="population-tables">Population tables</h2>
<p>These aren’t useful here, but there is information that is used to infer the data to a population.</p>
</section>
<section id="plot-geometry-table" class="level2">
<h2 class="anchored" data-anchor-id="plot-geometry-table">Plot Geometry Table</h2>
<ul>
<li>10.1.23 <em>FVS_LOC_CD</em>,</li>
</ul>
<p>Forest vegetation simulator location code</p>
</section>
</section>
<section id="section" class="level1">
<h1>————————–</h1>
</section>
<section id="treemap-bootstrap" class="level1">
<h1>TreeMap Bootstrap</h1>
<p>In various meetings, Karin has brought up that TreeMap does not have the same issue with rare classes as us. The following is looking into the TreeMap code to see why that is.</p>
<p><strong>Why doesn’t TreeMap get the empty classes error?</strong></p>
<p><strong>They don’t use bootstrap = T.</strong></p>
<hr>
<p><a href="https://github.com/USDAForestService/TreeMap2014_scripts">TreeMap Code</a></p>
<section id="treemap-code" class="level2">
<h2 class="anchored" data-anchor-id="treemap-code">TreeMap Code</h2>
<p>This is the TreeMap code copied from github in Sept.&nbsp;of 2024.</p>
<ul>
<li>Parts 1 and 2 are just reading the code.</li>
<li>Function lookup is learning about unfamiliar function.</li>
<li>Pseudo-code is re-writing the TreeMap code in plain language</li>
<li></li>
</ul>
<section id="part-1" class="level3">
<h3 class="anchored" data-anchor-id="part-1">Part 1</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform random forests imputation of FIA plot data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># written by Isaac Grenfell</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yaImpute)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="do">###Change this to match current directory and path</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>cur.zone <span class="ot">&lt;-</span> <span class="st">"z1"</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>outfolder <span class="ot">&lt;-</span> cur.zone</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2012</span><span class="sc">\\</span><span class="st">FIA</span><span class="sc">\\</span><span class="st">working_KLR"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>meters.db <span class="ot">&lt;-</span> <span class="fu">read.dbf</span>(<span class="st">"FIA_LFRDB_Albers.dbf"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="do">###Change this to match current directory and path</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">paste</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">target_data</span><span class="sc">\\</span><span class="st">final</span><span class="sc">\\</span><span class="st">"</span>, outfolder, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>()</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>cwd <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>flist.tif <span class="ot">&lt;-</span> <span class="fu">Sys.glob</span>(<span class="st">"*.tif"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create raster stack of input target grids</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>raster.stack <span class="ot">&lt;-</span> <span class="fu">stack</span>(flist.tif)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>p4s.albers <span class="ot">&lt;-</span> <span class="fu">proj4string</span>(raster.stack)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>raster.list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(flist.tif))</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>nrasters <span class="ot">&lt;-</span> <span class="fu">length</span>(flist.tif)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(flist.tif))  </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  raster.list[[i]] <span class="ot">&lt;-</span> <span class="fu">raster</span>()  </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="do">###Extract values about training points</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>nfiles.raster <span class="ot">&lt;-</span> <span class="fu">length</span>(flist.tif)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in x table of reference data</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>allplot <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">x_table</span><span class="sc">\\</span><span class="st">x_table_final_EVG_Karin_reclass_plus_loblolly_manual.txt"</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>remap <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">target_data</span><span class="sc">\\</span><span class="st">working_KLR</span><span class="sc">\\</span><span class="st">EVG_remap</span><span class="sc">\\</span><span class="st">"</span>, cur.zone, <span class="st">"_EVG_remap.txt"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co">#Limit allplot to just the veg types in the zone remap table</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>plot.df <span class="ot">&lt;-</span> allplot[allplot<span class="sc">$</span>EVT_GP <span class="sc">%in%</span> remap<span class="sc">$</span>V1,]</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(plot.df)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="do">###Change this to match current directory and path</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">outputs</span><span class="sc">\\</span><span class="st">"</span>, cur.zone, <span class="st">"_disturb"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>plot.df<span class="sc">$</span>CN <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot.df<span class="sc">$</span>CN)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(plot.df, <span class="fu">paste</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">outputs</span><span class="sc">\\</span><span class="st">"</span>, cur.zone, <span class="st">"_disturb</span><span class="sc">\\</span><span class="st">"</span>, cur.zone, <span class="st">"_x_table_allplots_reclass.txt"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">row.names =</span> F)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>merge.df <span class="ot">&lt;-</span> <span class="fu">merge</span>(plot.df, meters.db, <span class="at">by =</span> <span class="st">"CN"</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="do">##Build X predictor matrix</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>evg.fac <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plot.df<span class="sc">$</span>EVT_GP)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>dc.code.fac <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plot.df<span class="sc">$</span>disturb_code)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>dc.year.fac <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plot.df<span class="sc">$</span>disturb_year)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>dc.year.num <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(plot.df<span class="sc">$</span>disturb_year)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>lev.dc <span class="ot">&lt;-</span> <span class="fu">levels</span>(dc.code.fac)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>lev.year <span class="ot">&lt;-</span> <span class="fu">levels</span>(dc.year.fac)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>plot.df[,<span class="dv">18</span>] <span class="ot">&lt;-</span> evg.fac</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="do">##Build Y response matrix</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>plot.df<span class="sc">$</span>POINT_X <span class="ot">&lt;-</span> merge.df<span class="sc">$</span>POINT_X</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>plot.df<span class="sc">$</span>POINT_Y <span class="ot">&lt;-</span> merge.df<span class="sc">$</span>POINT_Y</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="do">###Change this to match current directory and path</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">paste</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">target_data</span><span class="sc">\\</span><span class="st">final</span><span class="sc">\\</span><span class="st">"</span>, outfolder, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="do">####Reclass evgs</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>evg.reclass <span class="ot">&lt;-</span> remap</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>n.evgs <span class="ot">&lt;-</span> <span class="fu">dim</span>(evg.reclass)[<span class="dv">1</span>]</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>evg.out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">dim</span>(plot.df)[<span class="dv">1</span>])</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>evg.vec <span class="ot">&lt;-</span> plot.df<span class="sc">$</span><span class="st">"EVT_GP"</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.evgs)  </span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>{  </span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  cur.evg <span class="ot">&lt;-</span> evg.reclass[i, <span class="dv">1</span>]  </span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  sub.ind <span class="ot">&lt;-</span> evg.vec <span class="sc">==</span> cur.evg  </span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>  evg.out[sub.ind] <span class="ot">&lt;-</span> i  </span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>}   </span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>evg.in <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(evg.out)</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>plot.df<span class="sc">$</span><span class="st">"EVT_GP"</span> <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(evg.out)</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>plot.df<span class="sc">$</span>disturb_code <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plot.df<span class="sc">$</span>disturb_code)</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co">#Create X Table</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>X.df <span class="ot">&lt;-</span> plot.df[,<span class="dv">5</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>aspect.temp <span class="ot">&lt;-</span> X.df<span class="sc">$</span>ASPECT</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>rad.temp <span class="ot">&lt;-</span> (pi<span class="sc">/</span><span class="dv">180</span>)<span class="sc">*</span>aspect.temp</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>northing.temp <span class="ot">&lt;-</span> <span class="fu">cos</span>(rad.temp)</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>easting.temp <span class="ot">&lt;-</span> <span class="fu">sin</span>(rad.temp)</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>X.df <span class="ot">&lt;-</span> X.df[,<span class="sc">-</span><span class="dv">2</span>]</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>X.df<span class="sc">$</span>NORTHING <span class="ot">&lt;-</span> northing.temp</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>X.df<span class="sc">$</span>EASTING <span class="ot">&lt;-</span>     easting.temp</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(X.df) <span class="ot">&lt;-</span> plot.df<span class="sc">$</span>ID</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>id.table <span class="ot">&lt;-</span>  plot.df<span class="sc">$</span>ID</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>Y.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(plot.df[,<span class="dv">16</span><span class="sc">:</span><span class="dv">18</span>])</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Y.df) <span class="ot">&lt;-</span> plot.df<span class="sc">$</span>ID</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a><span class="co">#X.df &lt;- X.df[,-c(9, 10)]</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a><span class="co"># build the random forests model (X=all predictors, Y=EVG, EVC, EVH)</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">56789</span>)</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>yai.treelist <span class="ot">&lt;-</span> <span class="fu">yai</span>(X.df, Y.df, <span class="at">method =</span> <span class="st">"randomForest"</span>, <span class="at">ntree =</span> <span class="dv">249</span>)</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>yai.treelist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2" class="level3">
<h3 class="anchored" data-anchor-id="part-2">Part 2</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build dataframes from the raster data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>raster.coords <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(raster.stack)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>asp.raster <span class="ot">&lt;-</span> raster.stack[[<span class="dv">1</span>]]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>dem.raster <span class="ot">&lt;-</span> raster.stack[[<span class="dv">2</span>]]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>currow.vals <span class="ot">&lt;-</span> <span class="fu">cellFromRow</span>(dem.raster, <span class="dv">1500</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>coords.currow <span class="ot">&lt;-</span> raster.coords[currow.vals,]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>extract.currow <span class="ot">&lt;-</span> <span class="fu">extract</span>(raster.stack, coords.currow)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>p4s.latlong <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">"+proj=longlat +datum=NAD83"</span>) </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>maxrow <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(X.df)))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>nrows.out <span class="ot">&lt;-</span> <span class="fu">dim</span>(raster.stack)[<span class="dv">1</span>]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>ncols.out <span class="ot">&lt;-</span> <span class="fu">dim</span>(raster.stack)[<span class="dv">2</span>]</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>rs2 <span class="ot">&lt;-</span> raster.stack</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>coords.all <span class="ot">&lt;-</span> raster.coords</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>x.vec <span class="ot">&lt;-</span> coords.all[,<span class="dv">1</span>]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>x.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(x.vec, <span class="at">nrow=</span>nrows.out)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>x.raster.out <span class="ot">&lt;-</span> <span class="fu">raster</span>(x.mat)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>x.raster.out<span class="sc">@</span>extent <span class="ot">&lt;-</span>dem.raster<span class="sc">@</span>extent</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>x.raster.out<span class="sc">@</span>crs <span class="ot">&lt;-</span>dem.raster<span class="sc">@</span>crs</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>y.vec <span class="ot">&lt;-</span> coords.all[,<span class="dv">2</span>]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>y.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(y.vec, <span class="at">nrow=</span>nrows.out)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>y.raster.out <span class="ot">&lt;-</span> <span class="fu">raster</span>(y.mat)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>y.raster.out<span class="sc">@</span>extent <span class="ot">&lt;-</span>dem.raster<span class="sc">@</span>extent</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>y.raster.out<span class="sc">@</span>crs <span class="ot">&lt;-</span>dem.raster<span class="sc">@</span>crs</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># impute.row()   ------------------------------------------------------------------------------</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform imputation</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>impute.row <span class="ot">&lt;-</span> <span class="cf">function</span>(currow)  </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>{  </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(yaImpute) </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(raster) </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(rgdal)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  currow.vals <span class="ot">&lt;-</span> <span class="fu">cellFromRow</span>(dem.raster, currow)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  coords.currow <span class="ot">&lt;-</span> raster.coords[currow.vals,]  </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get data from each row of rasters (coordinates)</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  sp.currow <span class="ot">&lt;-</span> <span class="fu">SpatialPoints</span>(coords.currow, <span class="fu">CRS</span>(p4s.albers)) </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  extract.currow <span class="ot">&lt;-</span> <span class="fu">extract</span>(rs2,   sp.currow)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  colseq <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(extract.currow[,<span class="dv">1</span>])</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  valid.cols <span class="ot">&lt;-</span> colseq[<span class="fu">as.logical</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">is.na</span>(extract.currow[,<span class="dv">1</span>]))]</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  ncols.df <span class="ot">&lt;-</span> <span class="fu">dim</span>(extract.currow)[<span class="dv">2</span>]</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  extract.currow <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(extract.currow)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  extract.currow<span class="sc">$</span><span class="st">"POINT_X"</span> <span class="ot">&lt;-</span> sp.currow<span class="sc">$</span>x</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  extract.currow<span class="sc">$</span><span class="st">"POINT_Y"</span> <span class="ot">&lt;-</span>sp.currow<span class="sc">$</span>y</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  extract.currow <span class="ot">&lt;-</span> <span class="fu">na.exclude</span>(extract.currow)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  X.df.temp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(extract.currow)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  nrow.temp <span class="ot">&lt;-</span> <span class="fu">dim</span>(X.df.temp)[<span class="dv">1</span>]</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  aspect.temp <span class="ot">&lt;-</span> X.df.temp<span class="sc">$</span>ASPECT  </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  rad.temp <span class="ot">&lt;-</span> (pi<span class="sc">/</span><span class="dv">180</span>)<span class="sc">*</span>aspect.temp  </span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  northing.temp <span class="ot">&lt;-</span> <span class="fu">cos</span>(rad.temp)  </span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  easting.temp <span class="ot">&lt;-</span> <span class="fu">sin</span>(rad.temp)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  X.df.temp <span class="ot">&lt;-</span> X.df.temp[,<span class="sc">-</span><span class="dv">1</span>]  </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  X.df.temp<span class="sc">$</span>NORTHING <span class="ot">&lt;-</span> northing.temp  </span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  X.df.temp<span class="sc">$</span>EASTING <span class="ot">&lt;-</span>  easting.temp  </span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  temp.evg <span class="ot">&lt;-</span> X.df.temp<span class="sc">$</span><span class="st">'EVT_GP'</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get nonappearing evgs   </span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  evg.orig <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n.evgs </span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  evg.val <span class="ot">&lt;-</span> evg.orig  </span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  evg.val.temp <span class="ot">&lt;-</span> X.df.temp<span class="sc">$</span><span class="st">'EVT_GP'</span>  </span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  n.evgs.orig <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(evg.orig)))  </span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  evg.orig.seq <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n.evgs.orig  </span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  nonappearing.evgs <span class="ot">&lt;-</span> evg.val[<span class="sc">-</span><span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(evg.val.temp))))]  </span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>  n.dummy.rows <span class="ot">&lt;-</span> <span class="fu">length</span>(nonappearing.evgs)  </span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  X.df.temp.old <span class="ot">&lt;-</span> X.df.temp</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(n.dummy.rows <span class="sc">&gt;</span> <span class="dv">0</span>)    </span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>  {    </span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    dummy.rows <span class="ot">&lt;-</span> X.df.temp[<span class="dv">1</span><span class="sc">:</span>n.dummy.rows,]    </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    tempchar <span class="ot">&lt;-</span> <span class="fu">as.character</span>(X.df.temp<span class="sc">$</span><span class="st">'EVT_GP'</span>)    </span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    X.df.temp<span class="sc">$</span><span class="st">'EVT_GP'</span> <span class="ot">&lt;-</span> tempchar    </span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    dummy.rows<span class="sc">$</span><span class="st">'EVT_GP'</span> <span class="ot">&lt;-</span> <span class="fu">as.character</span>(nonappearing.evgs)    </span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    X.df.temp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X.df.temp, dummy.rows)    </span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>  n.rows.orig <span class="ot">&lt;-</span> <span class="fu">dim</span>(extract.currow)[<span class="dv">1</span>]   </span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>  temp.fac <span class="ot">&lt;-</span> <span class="fu">factor</span>(X.df.temp<span class="sc">$</span><span class="st">'EVT_GP'</span>, <span class="at">levels =</span> <span class="fu">levels</span>(evg.in))  </span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>  dc.code.fac.temp <span class="ot">&lt;-</span> <span class="fu">factor</span>( X.df.temp<span class="sc">$</span>disturb_code, <span class="at">levels=</span>lev.dc)  </span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  X.df.temp<span class="sc">$</span><span class="st">'EVT_GP'</span> <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(temp.fac)  </span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  X.df.temp<span class="sc">$</span>disturb_code <span class="ot">&lt;-</span> dc.code.fac.temp   </span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>  nrow.temp <span class="ot">&lt;-</span> <span class="fu">dim</span>(X.df.temp)[<span class="dv">1</span>]  </span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>  impute.out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, nrow.temp)  </span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>  nc.orig <span class="ot">&lt;-</span> <span class="fu">dim</span>(coords.currow)[<span class="dv">1</span>]  </span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>  impute.out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,nc.orig)  </span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>  nrows.orig <span class="ot">&lt;-</span> <span class="fu">dim</span>(extract.currow)[<span class="dv">1</span>]  </span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(nrow.temp <span class="sc">&gt;</span> <span class="dv">0</span>)    </span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>  {    </span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>    colseq.out <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(X.df.temp)[<span class="dv">1</span>]    </span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>    rownames.all <span class="ot">&lt;-</span> colseq.out<span class="sc">+</span>maxrow    </span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(X.df.temp) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"T-"</span>, rownames.all)    </span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take object from formed random forests model and use X.df.temp dataframe to make predictions    </span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>    temp.newtargs <span class="ot">&lt;-</span> <span class="fu">newtargets</span>(yai.treelist, <span class="at">newdata =</span> X.df.temp)    </span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>    temp.xall <span class="ot">&lt;-</span> temp.newtargs<span class="sc">$</span>xall    </span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    out.neiIds <span class="ot">&lt;-</span> temp.newtargs<span class="sc">$</span>neiIdsTrgs    </span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    out.trgrows <span class="ot">&lt;-</span> temp.newtargs<span class="sc">$</span>trgRows    </span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>    yrows <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(out.neiIds[,<span class="dv">1</span>])    </span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>    id.out <span class="ot">&lt;-</span> id.table[yrows]    </span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>    impute.out[valid.cols] <span class="ot">&lt;-</span> yrows[<span class="dv">1</span><span class="sc">:</span>nrows.orig]    </span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(impute.out)  </span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a><span class="co"># end ----------------------------------------------------------------------</span></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">20</span>, <span class="at">port=</span><span class="st">"10187"</span>)</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>mout <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">m =</span> <span class="dv">1</span><span class="sc">:</span>nrows.out, <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"raster"</span>, <span class="st">"rgdal"</span>, <span class="st">"yaImpute"</span>), <span class="at">.combine=</span><span class="st">"rbind"</span>) <span class="sc">%dopar%</span>   <span class="fu">impute.row</span>(m)</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a><span class="fu">closeAllConnections</span>()</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a><span class="do">###this will return a matrix, all thats left is to write it out as a raster</span></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>m.raster <span class="ot">&lt;-</span>dem.raster</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>m.raster.out <span class="ot">&lt;-</span> <span class="fu">raster</span>(mout)</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>m.raster.out<span class="sc">@</span>extent <span class="ot">&lt;-</span>dem.raster<span class="sc">@</span>extent</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>m.raster.out<span class="sc">@</span>crs <span class="ot">&lt;-</span>dem.raster<span class="sc">@</span>crs</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a><span class="do">###Change this!</span></span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">paste</span>(<span class="st">"F:</span><span class="sc">\\</span><span class="st">Tree_List_c2014</span><span class="sc">\\</span><span class="st">outputs</span><span class="sc">\\</span><span class="st">"</span>, cur.zone, <span class="st">"_disturb"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>fout <span class="ot">&lt;-</span> <span class="fu">paste</span>(cur.zone, <span class="st">"_index-yes-disturb.tif"</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(m.raster.out, fout, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="function-lookup" class="level2">
<h2 class="anchored" data-anchor-id="function-lookup">Function Lookup</h2>
<ul>
<li><strong>base::Sys.glob</strong>
<ul>
<li>Function to do wildcard expansion (also known as ‘globbing’) on file paths.</li>
</ul></li>
<li><strong>raster::proj4string</strong>
<ul>
<li>Get or set the coordinate reference system (CRS) of a Raster* object.</li>
</ul></li>
<li><strong>base::vector</strong>
<ul>
<li>vector produces a ‘simple’ vector of the given length and mode, where a ‘simple’ vector has no attribute,</li>
</ul></li>
<li><strong>raster::coordinates</strong>
<ul>
<li>These functions get coordinates of the center of raster cells for a row, column, or cell number of a Raster* object.</li>
</ul></li>
<li><strong>raster::cellFromRow</strong>
<ul>
<li>Get cell number(s) of a Raster* object from row and/or column numbers. Cell numbers start at 1 in the upper left corner, and increase from left to right, and then from top to bottom. The last cell number equals the number of cells of the Raster* object.</li>
</ul></li>
<li><strong>raster::stack</strong>
<ul>
<li>A RasterStack is a collection of RasterLayer objects with the same spatial extent and resolution. A RasterStack can be created from RasterLayer objects, or from raster files, or both. It can also be created from a SpatialPixelsDataFrame or a SpatialGridDataFrame object.</li>
</ul></li>
<li><strong>parallel::makeCluster</strong>
<ul>
<li>Creates a set of copies of R running in parallel and communicating over sockets.</li>
</ul></li>
<li><strong>doParallel::registerDoParallel</strong>
<ul>
<li>The registerDoParallel function is used to register the parallel backend with the foreach package.</li>
</ul></li>
<li><strong>foreach::foreach</strong>
<ul>
<li>%do%⁠ and ⁠%dopar%⁠ are binary operators that operate on a foreach object and an R expression. The expression, ex, is evaluated multiple times in an environment that is created by the foreach object, and that environment is modified for each evaluation as specified by the foreach object. ⁠%do%⁠ evaluates the expression sequentially, while ⁠%dopar%⁠ evaluates it in parallel. The results of evaluating ex are returned as a list by default, but this can be modified by means of the .combine argument.</li>
</ul></li>
<li><strong>user::impute.row</strong>
<ul>
<li>Created above</li>
</ul></li>
<li><strong>parallel::stopCluster</strong>
<ul>
<li>Creates a set of copies of R running in parallel and communicating over sockets.</li>
</ul></li>
<li><strong>showConnections {base}::closeAllConnections</strong>
<ul>
<li>closes (and destroys) all user connections, restoring all sink diversions as it does so.</li>
</ul></li>
<li><strong>sp::SpatialPoints</strong>
<ul>
<li>create objects of class SpatialPoints-class or SpatialPointsDataFrame-class from coordinates, and from coordinates and data.frames</li>
</ul></li>
</ul>
</section>
<section id="pseudo-code" class="level2">
<h2 class="anchored" data-anchor-id="pseudo-code">Pseudo-Code</h2>
<section id="part-1-1" class="level3">
<h3 class="anchored" data-anchor-id="part-1-1">Part 1</h3>
<ol type="1">
<li>Set zone and working directory</li>
<li>list files and save tiff paths</li>
<li>stack tiffs</li>
<li>Project the stack</li>
<li>create a vector of tiff paths and get the length</li>
<li>for each tiff use the raster function to make it a raster object</li>
<li>get the number of files</li>
<li>Pull in the TreeMap tree list</li>
<li>set remap as the EVG list</li>
<li>remove plots to Veg types in current zone and get the new dimensions</li>
<li>save the filtered plots</li>
<li>join the plots to the <em>FIA_LFRDB.dbf</em></li>
</ol>
<p>**Build X and Y</p>
<ol type="1">
<li>Set EVT, dist_code, dist_yr as factors plus another for dist_yr as numeric.</li>
<li>record factor levels for dist_cd and year.</li>
<li>Add evt group to plot.df</li>
<li>set the X and Ys is plot.df</li>
<li>Enter the output folder</li>
<li>create a vector of length to fill</li>
<li>for the number of evgs,</li>
</ol>
<ul>
<li>set the current evg to match the rows of column 1 in evg.reclass.</li>
<li>set sub.ind to equal be T/F where the current evg vector matches the reclass</li>
<li>set evg.out to be i where T</li>
</ul>
<ol start="8" type="1">
<li>Set evg.in to factor(evg.out)</li>
<li>add the evg to plot.df</li>
<li>as dist_cd to plot.df</li>
<li>Create the X table with aspect, and other variables.</li>
<li>Create the Y table.</li>
<li>Run yai.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>yai.treelist <span class="ot">&lt;-</span> <span class="fu">yai</span>(X.df, Y.df, <span class="at">method =</span> <span class="st">"randomForest"</span>, <span class="at">ntree =</span> <span class="dv">249</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>They may have used bootstrap = T in the training of the model, but it is not here in the code.</strong> That is why they do not get the empty classes error.</p>
</section>
<section id="part-2-1" class="level3">
<h3 class="anchored" data-anchor-id="part-2-1">Part 2</h3>
<p><strong>Build dfs</strong></p>
<ol type="1">
<li>Get the raster coordinates for cell centers</li>
<li>Pull out the aspect and elevation rasters</li>
<li>Pull cell numbers in row 1500 from the dem</li>
<li>Get the coordinates of the centers for this row.</li>
<li>extract the data from the stack at these coordinates.</li>
<li>set coordinate system to p4s.latlong</li>
<li>Make a raster for the current rows Xs</li>
<li>Make a raster for the current rows Ys</li>
</ol>
<p><strong>Impute Rows Function</strong></p>
<ol type="1">
<li>Get the current row and the center coordinates</li>
<li>Make spatial points from centers</li>
<li>extract raster stack to spatial points.</li>
<li>Set up a df of the needed dimensions for the extracted data.</li>
<li>Add the X and Y coordinates.</li>
<li>Correct aspect to N and E.</li>
<li>Pull out and sort unique EVGs</li>
<li>Make another list with EVGs that do not appear.</li>
<li>if there are EVGs that do not appear, add rows for temporary variables</li>
<li>*Maybe remove the CNs that have EVGs that do not appear.</li>
<li>Use the yai object to get new targets for the filtered EVTs.</li>
<li>return the new tagets for the current row.</li>
</ol>
<p><strong>Impute the Map</strong></p>
<ol type="1">
<li>For each row, in parallel, impute the new targets to a matrix</li>
<li>Create a raster from the matrix.</li>
<li>save and exit.</li>
</ol>
</section>
</section>
</section>
<section id="section-1" class="level1">
<h1>——————————-</h1>
</section>
<section id="john-shaw-sqlite" class="level1">
<h1>John Shaw, SQLite</h1>
<p>This is from an email exchange with John Shaw. We asked him to review the filtering process in Oct 2024. Below is part of the exchange where he outlines the SQLite code to do what I did in R. He takes a slightly different approach by starting the process from all plots in OkWen. Otherwise, this is essentially the same thing as is in Data Prep/Import and Clean.</p>
<hr>
<p>I’m wondering if the buffering part is necessary, or even desirable. If you buffer on the OkWen boundaries first, it’s possible that you can bring in an ECOSUBCD that doesn’t occur on either forest. An alternative would be to get a list that’s based on the forests themselves, and then use that list to cast the larger net. My first step is just getting the ECOSUBCD list, which gives me 16 ECOSUBCDs with numbers of plots (all years) ranging between 10 and 797.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="st">"SELECT FS_FIADB_PLOT.ECOSUBCD, </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">Count(FS_FIADB_COND.CN) </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">AS CountOfCN </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">INTO OkWen_ECOSUBCDList</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">FROM FS_FIADB_COND </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN FS_FIADB_PLOT ON FS_FIADB_COND.PLT_CN = FS_FIADB_PLOT.CN</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE (((FS_FIADB_COND.ADFORCD)=608 Or (FS_FIADB_COND.ADFORCD)=617))</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY FS_FIADB_PLOT.ECOSUBCD;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the next step I’m using the ECOSUBCD list as the anchor for the rest of the selections, with some of your other filtering criteria applied and the remainder included as columns. For example, since we previously had a conversation about all conditions with trees (vs forested conditions), I’m leaving the query open to all single-condition plots. I’ve never looked at the PNW data closely to see if it happens, but theoretically it’s possible to have a multi-condition plot based on a break in the macroplot. Just to be safe, I’m also requiring MACROPROP_UNADJ=1. This is also the point where I’d grab everything I think I’ll need in the analysis from COND or PLOT, so all you’d have to do after this is use your keys (either COND.CN + COND.CONDID or PLOT.CN) to go fishing for your trees:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="st">"SELECT OkWen_ECOSUBCDList.ECOSUBCD, FS_FIADB_PLOT.CN, FS_FIADB_COND.CN AS COND_CN, </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.CONDID, </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_PLOT.DESIGNCD, </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.CONDPROP_UNADJ, </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.MACRPROP_UNADJ, </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_PLOT.PLOT_STATUS_CD, </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.FORTYPCD, </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.FLDTYPCD, </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.PRESNFCD, </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.HABTYPCD1, </span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.HABTYPCD1_PUB_CD, FS_FIADB_COND.HABTYPCD1_DESCR_PUB_CD, </span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.DSTRBCD1, </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.DSTRBYR1, </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.DSTRBCD2, </span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.DSTRBYR2, </span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.DSTRBCD3, </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.DSTRBYR3, </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.TRTCD1, </span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.TRTYR1, </span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.TRTCD2, </span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.TRTYR2, </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.TRTCD3, </span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIADB_COND.TRTYR3 </span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="st">INTO OkWen_AllPlot_CONDPROP1</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="st">FROM </span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="st">(FS_FIADB_COND RIGHT JOIN FS_FIADB_PLOT ON FS_FIADB_COND.PLT_CN = FS_FIADB_PLOT.CN) </span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="st">RIGHT JOIN OkWen_ECOSUBCDList ON FS_FIADB_PLOT.ECOSUBCD = OkWen_ECOSUBCDList.ECOSUBCD</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE (((FS_FIADB_PLOT.DESIGNCD)=501 Or (FS_FIADB_PLOT.DESIGNCD)=502) AND ((FS_FIADB_COND.CONDPROP_UNADJ)=1) AND ((FS_FIADB_COND.MACRPROP_UNADJ)=1));"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I get 9617 plots from that step, but I’ve included everything including nonforest, water, etc. Depending on the goal, you can filter by FORTYPCD&gt;0 (only forested conditions) or PLOT_STATUS_CD (1 or 2, to get forest and nonforest, but not water and other stuff).</p>
<p>An alternative approach that I’ve used to cast the larger net would be to use HABTYPCD1 as your anchor instead of ECOSUBCD, especially since you’re using the former as an independent variable in the analysis. When you use ECOSUBCD to reach out, you’re likely getting HABTYPCDs that don’t occur on OkWen. I’m guessing that they would be unneeded additions. If you take the HABTYPCD approach, you basically ignore the ECOSUBCD boundaries and look for anywhere that the HABTYPCD occurs. We had some discussions about this in some of the work I did with R1, since there were varying degrees of confidence within the team that a given habitat type was more-or-less the same thing wherever you found it. In my mind, that’s the whole purpose of habitat typing, and that’s now pretty much a standard approach for the planners. Back East they don’t use HTs like we do here, so ECOSUBCDs or other classifications pretty much have to be use there. The only difference between what I did for R1 and what’s above is that in the first step you use HABTYPCD1 as the grouping variable to make the list, and in the second step you use that list to extract the list.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="st">"SELECT FS_FIA_FVS_FVS_STANDINIT_PLOT.* </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">INTO OkWen_StandInit_Plot</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM OkWen_AllPlot_CONDPROP1 </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN FS_FIA_FVS_FVS_STANDINIT_PLOT </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">ON OkWen_AllPlot_CONDPROP1.CN = FS_FIA_FVS_FVS_STANDINIT_PLOT.STAND_CN;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">FS_FIA_FVS_FVS_TREEINIT_PLOT.* </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">INTO OkWen_TreeInit_Plot</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="st">FROM OkWen_AllPlot_CONDPROP1 </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN FS_FIA_FVS_FVS_TREEINIT_PLOT </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="st">ON OkWen_AllPlot_CONDPROP1.CN = FS_FIA_FVS_FVS_TREEINIT_PLOT.STAND_CN;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now you pretty much have everything you need, both to run the analysis and FVS (after renaming from what I have above), without actually manipulating any variables. If there’s a need to do more, you have the basic tables from which to do that.</p>
</section>
<section id="section-2" class="level1">
<h1>——————————-</h1>
</section>
<section id="git" class="level1">
<h1>Git</h1>
<ol type="1">
<li>git add .</li>
<li>git commit -m “comment”</li>
<li>git push origin main</li>
<li>quarto publish gh-pages document.qmd</li>
<li>quarto publish gh-pages –no-prompt</li>
<li>quarto publish gh-pages –no-render</li>
<li>quarto publish gh-pages –no-browser</li>
</ol>
</section>
<section id="end" class="level1">
<h1>END</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/KingBlkMouth\.github\.io\/Regen_Regression\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>